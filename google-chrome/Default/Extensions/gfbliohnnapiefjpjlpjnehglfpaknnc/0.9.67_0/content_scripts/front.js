"use strict";function createFront(){function e(e,n){e.commandToFrontend=!0,e.origin=getDocumentOrigin(),e.id=generateQuickGuid(),n&&(e.ack=!0,a[e.id]=n),r.then(function(){runtime.postTopMessage(e)})}function n(){return[Normal.mappings,Visual.mappings,Insert.mappings].map(getAnnotations).reduce(function(e,n){return e.concat(n)})}function t(e){"DIV"===f.nodeName?f.innerText=e:f.value=e;var n=document.createEvent("HTMLEvents");n.initEvent("change",!1,!0),f.dispatchEvent(n)}function i(){w&&(clearTimeout(w),w=void 0)}var o={},r=new Promise(function(e,n){window===top?o.resolve=e:e(window.location.href)}),a={},u=[];o.setUserSettings=function(e){u.push({action:"applyUserSettings",userSettings:e})},o.applyUserSettings=function(){var n=!0,t=!1,i=void 0;try{for(var o,r=u[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var a=o.value;e(a)}}catch(c){t=!0,i=c}finally{try{!n&&r["return"]&&r["return"]()}finally{if(t)throw i}}};var c={};o.addSearchAlias=function(e,n,t,i,o){i&&o&&(c[i]=o),u.push({action:"addSearchAlias",alias:e,prompt:n,url:t,suggestionURL:i})},o.removeSearchAlias=function(e){u.push({action:"removeSearchAlias",alias:e})};var s={};o.performInlineQueryOnSelection=function(e){var n=document.getSelection().getRangeAt(0).getClientRects()[0];Front.performInlineQuery(e,function(e){e&&Front.showBubble({top:n.top,left:n.left,height:n.height,width:n.width},e,!1)})},o.querySelectedWord=function(){var e=document.getSelection(),n=e.toString().trim();n&&!/[\W_]/.test(n)&&n.length&&"Range"===e.type&&o.performInlineQueryOnSelection(n)},s.updateInlineQuery=function(e){e.word?o.performInlineQueryOnSelection(e.word):o.querySelectedWord()},s.getSearchSuggestions=function(e){var n=null;return c.hasOwnProperty(e.url)&&(n=c[e.url](e.response)),n},o.executeCommand=function(n){e({action:"executeCommand",cmdline:n})},o.addMapkey=function(e,n,t){u.push({action:"addMapkey",mode:e,new_keystroke:n,old_keystroke:t})},o.addVimMap=function(e,n,t){u.push({action:"addVimMap",lhs:e,rhs:n,ctx:t})},o.addVimKeyMap=function(e){u.push({action:"addVimKeyMap",vimKeyMap:e})};var d=createElementWithContent("div","Hi, I'm here now!",{id:"sk_frame"});d.fromSurfingKeys=!0,o.highlightElement=function(e){document.documentElement.append(d);var n=e.rect;d.style.top=n.top+"px",d.style.left=n.left+"px",d.style.width=n.width+"px",d.style.height=n.height+"px",d.style.display="",setTimeout(function(){d.remove()},e.duration)},o.showUsage=function(){e({action:"showUsage",metas:n()})},o.getUsage=function(t){e({action:"getUsage",metas:n()},function(e){t(e.data)})},o.showPopup=function(n){e({action:"showPopup",content:n})},o.hidePopup=function(){e({action:"hidePopup"})};var l,f;o.showEditor=function(n,i,o){var r,o=o||n.localName,a=0;if("string"==typeof n)r=n,f=document.body;else if("select"===o){var u=n.value;r=Array.from(n.querySelectorAll("option")).map(function(e,n){return e.value===u&&(a=n),e.innerText.trim()+" >< "+e.value}).join("\n"),f=n}else f=n,r="DIV"===f.nodeName?f.innerText:f.value;l=i||t,e({action:"showEditor",type:o||"textarea",initial_line:a,content:r})},o.chooseTab=function(){""!==Normal.repeats?RUNTIME("focusTabByIndex"):e({action:"chooseTab"})},o.openOmnibar=function(n){n.action="openOmnibar",e(n)};var m,p;o.performInlineQuery=function(e,n){m?(runtime.conf.autoSpeakOnInlineQuery&&readText(e),e=e.toLocaleLowerCase(),runtime.updateHistory("OmniQuery",e),httpRequest({url:"function"==typeof m.url?m.url(e):m.url+e,headers:m.headers},function(e){n(m.parseResult(e))})):isInUIFrame()?(p=n,document.getElementById("proxyFrame").contentWindow.postMessage({action:"performInlineQuery",query:e},"*")):(tabOpenLink("https://github.com/brookhong/Surfingkeys/wiki/Register-inline-query"),o.hidePopup())},o.registerInlineQuery=function(e){m=e},o.openOmniquery=function(e){o.openOmnibar({type:"OmniQuery",extra:e.query,style:e.style})},o.openFinder=function(){e({action:"openFinder"})},o.showBanner=function(n,t){e({action:"showBanner",content:n,linger_time:t})},o.showBubble=function(n,t,i){t.length>0&&(n.winWidth=window.innerWidth,n.winHeight=window.innerHeight,n.winX=0,n.winY=0,window.frameElement&&(n.winX=window.frameElement.offsetLeft,n.winY=window.frameElement.offsetTop),e({action:"showBubble",content:t,position:n,noPointerEvents:i}))},o.hideBubble=function(){e({action:"hideBubble"})};var h={accumulated:"",candidates:{},key:""};o.hideKeystroke=function(){h.accumulated="",h.candidates={},e({action:"hideKeystroke"})},o.showKeystroke=function(n,t){h.accumulated+=n,h.key=n,h.candidates={};var i=t.mappings.find(h.accumulated);i&&i.getMetas(function(e){return!0}).forEach(function(e){h.candidates[e.word]={annotation:e.annotation}}),e({action:"showKeystroke",keyHints:h})},o.showStatus=function(n,t,i){e({action:"showStatus",content:t,duration:i,position:n})},o.toggleStatus=function(n){e({action:"toggleStatus",visible:n})},s.ace_editor_saved=function(e){void 0!==e.data&&l(e.data),runtime.conf.focusOnSaved&&isEditable(f)&&(Normal.passFocus(!0),f.focus(),Insert.enter(f))},s.nextEdit=function(e){var n=Hints.getSelector()||"input, textarea, *[contenteditable=true], select";if(n=getElements(n),n.length){var t=n.indexOf(f);t=(t+(e.backward?-1:1))%n.length,n=n[t],scrollIntoViewIfNeeded(n),Hints.flashPressedLink(n),o.showEditor(n)}},s.omnibar_query_entered=function(n){runtime.updateHistory("OmniQuery",n.query),o.performInlineQuery(n.query,function(t){if("Array"!==t.constructor.name&&(t=[t]),window.navigator.userAgent.indexOf("Firefox")===-1){var i=Visual.findSentenceOf(n.query);i.length>0&&t.push(i)}e({action:"updateOmnibarResult",words:t})})},s.executeScript=function(n){RUNTIME("executeScript",{code:n.cmdline},function(n){e({action:"updateOmnibarResult",words:n.response})})},s.getBackFocus=function(e){window.focus(),window===top&&window.uiHost&&window.uiHost.shadowRoot.contains(document.activeElement)&&document.activeElement.blur()},s.getPageText=function(e){return document.body.innerText};var w;s.visualUpdate=function(n){i(),w=setTimeout(function(){Visual.visualUpdateForContentWindow(n.query),window.navigator.userAgent.indexOf("Firefox")!==-1&&e({action:"visualUpdatedForFirefox"})},500)},s.visualClear=function(e){i(),Visual.visualClear()},s.visualEnter=function(e){i(),Visual.visualEnter(e.query)},s.emptySelection=function(e){document.getSelection().empty()};var g=!1;return s.deactivated=function(e){g=!1},s.activated=function(e){g=!0},runtime.on("focusFrame",function(e,n,t){e.frameId===window.frameId&&(window.focus(),document.body.scrollIntoView({behavior:"auto",block:"center",inline:"center"}),o.highlightElement({duration:500,rect:{top:0,left:0,width:window.innerWidth,height:window.innerHeight}}))}),window.addEventListener("message",function(e){var n=e.data;if(void 0!==n)if("performInlineQuery"===n.action)o.performInlineQuery(n.query,function(n){e.source.postMessage({action:"performInlineQueryResult",result:n},e.origin)});else if("performInlineQueryResult"===n.action)p(n.result);else if(g){if(n.responseToContent&&a[n.id]){var t=a[n.id];t(n)||delete a[n.id]}else if(n.commandToContent&&n.action&&s.hasOwnProperty(n.action)){var i=s[n.action](n);n.ack&&runtime.postTopMessage({data:i,responseToFrontend:!0,origin:n.origin,id:n.id})}}else"activated"===n.action&&s.activated(n)},!0),o}
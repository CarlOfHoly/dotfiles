/*! @license DOMPurify | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.0.8/LICENSE */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).DOMPurify=t()}(this,(function(){"use strict";var e=Object.hasOwnProperty,t=Object.setPrototypeOf,n=Object.isFrozen,r=Object.keys,o=Object.freeze,i=Object.seal,a="undefined"!=typeof Reflect&&Reflect,l=a.apply,c=a.construct;l||(l=function(e,t,n){return e.apply(t,n)}),o||(o=function(e){return e}),i||(i=function(e){return e}),c||(c=function(e,t){return new(Function.prototype.bind.apply(e,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))))});var s=S(Array.prototype.forEach),u=S(Array.prototype.indexOf),d=S(Array.prototype.join),f=S(Array.prototype.pop),p=S(Array.prototype.push),m=S(Array.prototype.slice),y=S(String.prototype.toLowerCase),g=S(String.prototype.match),h=S(String.prototype.replace),v=S(String.prototype.indexOf),b=S(String.prototype.trim),T=S(RegExp.prototype.test),A=k(RegExp),x=k(TypeError);function S(e){return function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return l(e,t,r)}}function k(e){return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return c(e,n)}}function L(e,r){t&&t(e,null);for(var o=r.length;o--;){var i=r[o];if("string"==typeof i){var a=y(i);a!==i&&(n(r)||(r[o]=a),i=a)}e[i]=!0}return e}function _(t){var n={},r=void 0;for(r in t)l(e,t,[r])&&(n[r]=t[r]);return n}var E=o(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),M=o(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","audio","canvas","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","video","view","vkern"]),D=o(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),R=o(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),N=o(["#text"]),O=o(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns"]),w=o(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),H=o(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),C=o(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),F=i(/\{\{[\s\S]*|[\s\S]*\}\}/gm),z=i(/<%[\s\S]*|[\s\S]*%>/gm),I=i(/^data-[\-\w.\u00B7-\uFFFF]/),U=i(/^aria-[\-\w]+$/),j=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),P=i(/^(?:\w+script|data):/i),G=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g),W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function B(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var q=function(){return"undefined"==typeof window?null:window},K=function(e,t){if("object"!==(void 0===e?"undefined":W(e))||"function"!=typeof e.createPolicy)return null;var n=null;t.currentScript&&t.currentScript.hasAttribute("data-tt-policy-suffix")&&(n=t.currentScript.getAttribute("data-tt-policy-suffix"));var r="dompurify"+(n?"#"+n:"");try{return e.createPolicy(r,{createHTML:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+r+" could not be created."),null}};return function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q(),n=function(t){return e(t)};if(n.version="2.0.10",n.removed=[],!t||!t.document||9!==t.document.nodeType)return n.isSupported=!1,n;var i=t.document,a=!1,l=t.document,c=t.DocumentFragment,S=t.HTMLTemplateElement,k=t.Node,V=t.NodeFilter,Y=t.NamedNodeMap,X=void 0===Y?t.NamedNodeMap||t.MozNamedAttrMap:Y,$=t.Text,J=t.Comment,Q=t.DOMParser,Z=t.trustedTypes;if("function"==typeof S){var ee=l.createElement("template");ee.content&&ee.content.ownerDocument&&(l=ee.content.ownerDocument)}var te=K(Z,i),ne=te?te.createHTML(""):"",re=l,oe=re.implementation,ie=re.createNodeIterator,ae=re.getElementsByTagName,le=re.createDocumentFragment,ce=i.importNode,se={};n.isSupported=oe&&void 0!==oe.createHTMLDocument&&9!==l.documentMode;var ue=F,de=z,fe=I,pe=U,me=P,ye=G,ge=j,he=null,ve=L({},[].concat(B(E),B(M),B(D),B(R),B(N))),be=null,Te=L({},[].concat(B(O),B(w),B(H),B(C))),Ae=null,xe=null,Se=!0,ke=!0,Le=!1,_e=!1,Ee=!1,Me=!1,De=!1,Re=!1,Ne=!1,Oe=!1,we=!1,He=!1,Ce=!0,Fe=!0,ze=!1,Ie={},Ue=L({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","plaintext","script","style","svg","template","thead","title","video","xmp"]),je=null,Pe=L({},["audio","video","img","source","image","track"]),Ge=null,We=L({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),Be=null,qe=l.createElement("form"),Ke=function(e){Be&&Be===e||(e&&"object"===(void 0===e?"undefined":W(e))||(e={}),he="ALLOWED_TAGS"in e?L({},e.ALLOWED_TAGS):ve,be="ALLOWED_ATTR"in e?L({},e.ALLOWED_ATTR):Te,Ge="ADD_URI_SAFE_ATTR"in e?L(_(We),e.ADD_URI_SAFE_ATTR):We,je="ADD_DATA_URI_TAGS"in e?L(_(Pe),e.ADD_DATA_URI_TAGS):Pe,Ae="FORBID_TAGS"in e?L({},e.FORBID_TAGS):{},xe="FORBID_ATTR"in e?L({},e.FORBID_ATTR):{},Ie="USE_PROFILES"in e&&e.USE_PROFILES,Se=!1!==e.ALLOW_ARIA_ATTR,ke=!1!==e.ALLOW_DATA_ATTR,Le=e.ALLOW_UNKNOWN_PROTOCOLS||!1,_e=e.SAFE_FOR_JQUERY||!1,Ee=e.SAFE_FOR_TEMPLATES||!1,Me=e.WHOLE_DOCUMENT||!1,Ne=e.RETURN_DOM||!1,Oe=e.RETURN_DOM_FRAGMENT||!1,we=e.RETURN_DOM_IMPORT||!1,He=e.RETURN_TRUSTED_TYPE||!1,Re=e.FORCE_BODY||!1,Ce=!1!==e.SANITIZE_DOM,Fe=!1!==e.KEEP_CONTENT,ze=e.IN_PLACE||!1,ge=e.ALLOWED_URI_REGEXP||ge,Ee&&(ke=!1),Oe&&(Ne=!0),Ie&&(he=L({},[].concat(B(N))),be=[],!0===Ie.html&&(L(he,E),L(be,O)),!0===Ie.svg&&(L(he,M),L(be,w),L(be,C)),!0===Ie.svgFilters&&(L(he,D),L(be,w),L(be,C)),!0===Ie.mathMl&&(L(he,R),L(be,H),L(be,C))),e.ADD_TAGS&&(he===ve&&(he=_(he)),L(he,e.ADD_TAGS)),e.ADD_ATTR&&(be===Te&&(be=_(be)),L(be,e.ADD_ATTR)),e.ADD_URI_SAFE_ATTR&&L(Ge,e.ADD_URI_SAFE_ATTR),Fe&&(he["#text"]=!0),Me&&L(he,["html","head","body"]),he.table&&(L(he,["tbody"]),delete Ae.tbody),o&&o(e),Be=e)},Ve=function(e){p(n.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=ne}},Ye=function(e,t){try{p(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){p(n.removed,{attribute:null,from:t})}t.removeAttribute(e)},Xe=function(e){var t=void 0,n=void 0;if(Re)e="<remove></remove>"+e;else{var r=g(e,/^[\s]+/);n=r&&r[0]}var o=te?te.createHTML(e):e;try{t=(new Q).parseFromString(o,"text/html")}catch(e){}if(a&&L(Ae,["title"]),!t||!t.documentElement){var i=(t=oe.createHTMLDocument("")).body;i.parentNode.removeChild(i.parentNode.firstElementChild),i.outerHTML=o}return e&&n&&t.body.insertBefore(l.createTextNode(n),t.body.childNodes[0]||null),ae.call(t,Me?"html":"body")[0]};n.isSupported&&function(){try{var e=Xe("<x/><title>&lt;/title&gt;&lt;img&gt;");T(/<\/title/,e.querySelector("title").innerHTML)&&(a=!0)}catch(e){}}();var $e=function(e){return ie.call(e.ownerDocument||e,e,V.SHOW_ELEMENT|V.SHOW_COMMENT|V.SHOW_TEXT,(function(){return V.FILTER_ACCEPT}),!1)},Je=function(e){return!(e instanceof $||e instanceof J)&&!("string"==typeof e.nodeName&&"string"==typeof e.textContent&&"function"==typeof e.removeChild&&e.attributes instanceof X&&"function"==typeof e.removeAttribute&&"function"==typeof e.setAttribute&&"string"==typeof e.namespaceURI)},Qe=function(e){return"object"===(void 0===k?"undefined":W(k))?e instanceof k:e&&"object"===(void 0===e?"undefined":W(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},Ze=function(e,t,r){se[e]&&s(se[e],(function(e){e.call(n,t,r,Be)}))},et=function(e){var t=void 0;if(Ze("beforeSanitizeElements",e,null),Je(e))return Ve(e),!0;var r=y(e.nodeName);if(Ze("uponSanitizeElement",e,{tagName:r,allowedTags:he}),("svg"===r||"math"===r)&&0!==e.querySelectorAll("p, br").length)return Ve(e),!0;if(!he[r]||Ae[r]){if(Fe&&!Ue[r]&&"function"==typeof e.insertAdjacentHTML)try{var o=e.innerHTML;e.insertAdjacentHTML("AfterEnd",te?te.createHTML(o):o)}catch(e){}return Ve(e),!0}return"noscript"===r&&T(/<\/noscript/i,e.innerHTML)||"noembed"===r&&T(/<\/noembed/i,e.innerHTML)?(Ve(e),!0):(!_e||e.firstElementChild||e.content&&e.content.firstElementChild||!T(/</g,e.textContent)||(p(n.removed,{element:e.cloneNode()}),e.innerHTML?e.innerHTML=h(e.innerHTML,/</g,"&lt;"):e.innerHTML=h(e.textContent,/</g,"&lt;")),Ee&&3===e.nodeType&&(t=e.textContent,t=h(t,ue," "),t=h(t,de," "),e.textContent!==t&&(p(n.removed,{element:e.cloneNode()}),e.textContent=t)),Ze("afterSanitizeElements",e,null),!1)},tt=function(e,t,n){if(Ce&&("id"===t||"name"===t)&&(n in l||n in qe))return!1;if(ke&&T(fe,t));else if(Se&&T(pe,t));else{if(!be[t]||xe[t])return!1;if(Ge[t]);else if(T(ge,h(n,ye,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==v(n,"data:")||!je[e]){if(Le&&!T(me,h(n,ye,"")));else if(n)return!1}else;}return!0},nt=function(e){var t=void 0,o=void 0,i=void 0,a=void 0,l=void 0;Ze("beforeSanitizeAttributes",e,null);var c=e.attributes;if(c){var s={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:be};for(l=c.length;l--;){var p=t=c[l],g=p.name,v=p.namespaceURI;if(o=b(t.value),i=y(g),s.attrName=i,s.attrValue=o,s.keepAttr=!0,s.forceKeepAttr=void 0,Ze("uponSanitizeAttribute",e,s),o=s.attrValue,!s.forceKeepAttr){if("name"===i&&"IMG"===e.nodeName&&c.id)a=c.id,c=m(c,[]),Ye("id",e),Ye(g,e),u(c,a)>l&&e.setAttribute("id",a.value);else{if("INPUT"===e.nodeName&&"type"===i&&"file"===o&&s.keepAttr&&(be[i]||!xe[i]))continue;"id"===g&&e.setAttribute(g,""),Ye(g,e)}if(s.keepAttr)if(_e&&T(/\/>/i,o))Ye(g,e);else if(T(/svg|math/i,e.namespaceURI)&&T(A("</("+d(r(Ue),"|")+")","i"),o))Ye(g,e);else{Ee&&(o=h(o,ue," "),o=h(o,de," "));var x=e.nodeName.toLowerCase();if(tt(x,i,o))try{v?e.setAttributeNS(v,g,o):e.setAttribute(g,o),f(n.removed)}catch(e){}}}}Ze("afterSanitizeAttributes",e,null)}},rt=function e(t){var n=void 0,r=$e(t);for(Ze("beforeSanitizeShadowDOM",t,null);n=r.nextNode();)Ze("uponSanitizeShadowNode",n,null),et(n)||(n.content instanceof c&&e(n.content),nt(n));Ze("afterSanitizeShadowDOM",t,null)};return n.sanitize=function(e,r){var o=void 0,a=void 0,l=void 0,s=void 0,u=void 0;if(e||(e="\x3c!--\x3e"),"string"!=typeof e&&!Qe(e)){if("function"!=typeof e.toString)throw x("toString is not a function");if("string"!=typeof(e=e.toString()))throw x("dirty is not a string, aborting")}if(!n.isSupported){if("object"===W(t.toStaticHTML)||"function"==typeof t.toStaticHTML){if("string"==typeof e)return t.toStaticHTML(e);if(Qe(e))return t.toStaticHTML(e.outerHTML)}return e}if(De||Ke(r),n.removed=[],"string"==typeof e&&(ze=!1),ze);else if(e instanceof k)1===(a=(o=Xe("\x3c!--\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===a.nodeName||"HTML"===a.nodeName?o=a:o.appendChild(a);else{if(!Ne&&!Ee&&!Me&&He&&-1===e.indexOf("<"))return te?te.createHTML(e):e;if(!(o=Xe(e)))return Ne?null:ne}o&&Re&&Ve(o.firstChild);for(var d=$e(ze?e:o);l=d.nextNode();)3===l.nodeType&&l===s||et(l)||(l.content instanceof c&&rt(l.content),nt(l),s=l);if(s=null,ze)return e;if(Ne){if(Oe)for(u=le.call(o.ownerDocument);o.firstChild;)u.appendChild(o.firstChild);else u=o;return we&&(u=ce.call(i,u,!0)),u}var f=Me?o.outerHTML:o.innerHTML;return Ee&&(f=h(f,ue," "),f=h(f,de," ")),te&&He?te.createHTML(f):f},n.setConfig=function(e){Ke(e),De=!0},n.clearConfig=function(){Be=null,De=!1},n.isValidAttribute=function(e,t,n){Be||Ke({});var r=y(e),o=y(t);return tt(r,o,n)},n.addHook=function(e,t){"function"==typeof t&&(se[e]=se[e]||[],p(se[e],t))},n.removeHook=function(e){se[e]&&f(se[e])},n.removeHooks=function(e){se[e]&&(se[e]=[])},n.removeAllHooks=function(){se={}},n}()}));
//# sourceMappingURL=purify.min.js.map

"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function Trie(){arguments.length>0&&(this.stem=arguments[0]),arguments.length>1&&(this.meta=arguments[1])}function createKeyboardUtils(){function e(e,n){var o=0;e.indexOf("Ctrl-")!==-1&&(o|=1),e.indexOf("Alt-")!==-1&&(o|=2),e.indexOf("Meta-")!==-1&&(o|=4),e.indexOf("Shift-")!==-1&&(o|=8);var r;return r=n.length>1?256+t.specialKeys.indexOf(n):n.charCodeAt(0),r=8192+(r<<4)+o,String.fromCharCode(r)}var t={keyCodesMac:{Minus:["-","_"],Equal:["=","+"],BracketLeft:["[","{"],BracketRight:["]","}"],Backslash:["\\","|"],Semicolon:[";",":"],Quote:["'",'"'],Comma:[",","<"],Period:[".",">"],Slash:["/","?"]},keyCodes:{ESC:27,backspace:8,deleteKey:46,enter:13,ctrlEnter:10,space:32,shiftKey:16,ctrlKey:17,f1:112,f12:123,comma:188,tab:9,downArrow:40,upArrow:38},modifierKeys:{16:"Shift",17:"Ctrl",18:"Alt",91:"Meta",92:"Meta",93:"ContextMenu",229:"Process"},keyNames:{8:"Backspace",9:"Tab",12:"NumLock",27:"Esc",32:"Space",46:"Delete"},keyIdentifierCorrectionMap:{"U+00C0":["U+0060","U+007E"],"U+0030":["U+0030","U+0029"],"U+0031":["U+0031","U+0021"],"U+0032":["U+0032","U+0040"],"U+0033":["U+0033","U+0023"],"U+0034":["U+0034","U+0024"],"U+0035":["U+0035","U+0025"],"U+0036":["U+0036","U+005E"],"U+0037":["U+0037","U+0026"],"U+0038":["U+0038","U+002A"],"U+0039":["U+0039","U+0028"],"U+00BD":["U+002D","U+005F"],"U+00BB":["U+003D","U+002B"],"U+00DB":["U+005B","U+007B"],"U+00DD":["U+005D","U+007D"],"U+00DC":["U+005C","U+007C"],"U+00BA":["U+003B","U+003A"],"U+00DE":["U+0027","U+0022"],"U+00BC":["U+002C","U+003C"],"U+00BE":["U+002E","U+003E"],"U+00BF":["U+002F","U+003F"]}},n="Windows";return"undefined"!=typeof navigator&&(navigator.platform.indexOf("Mac")!==-1?n="Mac":navigator.userAgent.indexOf("Linux")!==-1&&(n="Linux")),t.getKeyChar=function(e){var o;if(e.keyCode in this.modifierKeys)o="";else{if(this.keyNames.hasOwnProperty(e.keyCode))o="{0}".format(this.keyNames[e.keyCode]);else if(o=e.key||"",["Shift","Meta","Alt","Ctrl"].indexOf(o)!==-1&&(o=""),o)o.charCodeAt(0)>127||"Dead"===o?e.keyCode<127?(o=String.fromCharCode(e.keyCode),o=e.shiftKey?o:o.toLowerCase()):this.keyCodesMac.hasOwnProperty(e.code)&&(o=this.keyCodesMac[e.code][e.shiftKey?1:0]):"Unidentified"===o&&(o="");else if(e.keyIdentifier)if("U+"!==e.keyIdentifier.slice(0,2))o="{0}".format(e.keyIdentifier);else{var r=e.keyIdentifier;if(("Windows"===n||"Linux"===n)&&this.keyIdentifierCorrectionMap[r]){var i=this.keyIdentifierCorrectionMap[r];r=e.shiftKey?i[1]:i[0]}var s="0x"+r.substring(2);o=String.fromCharCode(parseInt(s)),o=e.shiftKey?o:o.toLowerCase()}e.shiftKey&&o.length>1&&(o="Shift-"+o),o.length>0&&(e.metaKey&&(o="Meta-"+o),e.altKey&&(o="Alt-"+o),e.ctrlKey&&(o="Ctrl-"+o)),o.length>1&&(o="<{0}>".format(o))}return t.decodeKeystroke(t.encodeKeystroke(o))===o&&(o=t.encodeKeystroke(o)),o},t.isWordChar=function(e){return e.keyCode<123&&e.keyCode>=97||e.keyCode<91&&e.keyCode>=65||e.keyCode<58&&e.keyCode>=48},t.encodeKeystroke=function(t){for(var n,o=/<(?:Ctrl-)?(?:Alt-)?(?:Meta-)?(?:Shift-)?([^>]+|.)>/g,r="",i=0;null!==(n=o.exec(t));)r+=t.substr(i,n.index-i),r+=e(n[0],n[1]),i=o.lastIndex;return r+=t.substr(i)},t.specialKeys=["Esc","Space","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Backspace","Enter","Tab","Delete","End","Home","Insert","NumLock","PageDown","PageUp","Pause","ScrollLock","CapsLock","PrintScreen","Escape","Hyper"],t.decodeKeystroke=function(e){for(var n="",o=0;o<e.length;o++){var r=e[o].charCodeAt(0);if(r>8192){r-=8192;var i=r>>12,s=r%4096>>4,a=15&r;r=i?t.specialKeys[s%256]:String.fromCharCode(s),8&a&&(r="Shift-"+r),4&a&&(r="Meta-"+r),2&a&&(r="Alt-"+r),1&a&&(r="Ctrl-"+r),n+="<"+r+">"}else n+=e[o]}return n},t}function isInUIFrame(){return 0===document.location.href.indexOf(chrome.extension.getURL(""))}function timeStampString(e){var t=new Date;return t.setTime(e),t.toLocaleString()}function getDocumentOrigin(){var e=window.location.origin?window.location.origin:"*";return"file://"!==e&&"null"!==e||(e="*"),e}function generateQuickGuid(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function listElements(e,t,n){for(var o=[],r=void 0,i=document.createNodeIterator(e,t,null);r=i.nextNode();)n(r)&&o.push(r),r.shadowRoot&&o.push.apply(o,_toConsumableArray(listElements(r.shadowRoot,t,n)));return o}function isElementVisible(e){return e.offsetHeight>0&&e.offsetWidth>0}function isElementClickable(e){var t="a, button, select, input, textarea, summary, *[onclick], *[contenteditable=true], *.jfk-button, *.goog-flat-menu-button, *[role=button], *[role=link], *[role=menuitem], *[role=option], *[role=switch], *[role=tab], *[role=checkbox], *[role=combobox], *[role=menuitemcheckbox], *[role=menuitemradio]";return runtime.conf.clickableSelector.length&&(t+=", "+runtime.conf.clickableSelector),e.matches(t)||"pointer"===getComputedStyle(e).cursor||"url("===getComputedStyle(e).cursor.substr(0,4)||null!==e.closest("a, *[onclick], *[contenteditable=true], *.jfk-button, *.goog-flat-menu-button")}function dispatchMouseEvent(e,t,n){t.forEach(function(t){var o=n?1:0,r=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,button:o});e.dispatchEvent(r)})}function getRealEdit(e){for(var t=e?e.target:document.activeElement;t&&t.shadowRoot;){if(!t.shadowRoot.activeElement){if(t.shadowRoot.querySelector("input, textarea, select")){t=t.shadowRoot.querySelector("input, textarea, select");break}break}t=t.shadowRoot.activeElement}return t===window&&(t=document.body),t}function toggleQuote(){var e=getRealEdit(),t=e.value;'"'===t[0]?e.value=t.substr(1,t.length-2):e.value='"'+t+'"'}function isEditable(e){return e&&!e.disabled&&("textarea"===e.localName||"select"===e.localName||e.isContentEditable||e.matches(runtime.conf.editableSelector)||"input"===e.localName&&/^(?!button|checkbox|file|hidden|image|radio|reset|submit)/i.test(e.type))}function parseQueryString(e){var t={};if(e.length)for(var n=e.split("&"),o=0,r=n.length;o<r;++o){var i=n[o].split("="),s=i[0].toLowerCase(),a=i.length>1?i[1]:null;t[decodeURIComponent(s)]=decodeURIComponent(a)}return t}function reportIssue(e,t){e=encodeURIComponent(e),t="%23%23+Error+details%0A%0A{0}%0A%0ASurfingKeys%3A+{1}%0A%0AChrome%3A+{2}%0A%0AURL%3A+{3}%0A%0A%23%23+Context%0A%0A%2A%2APlease+replace+this+with+a+description+of+how+you+were+using+SurfingKeys.%2A%2A".format(encodeURIComponent(t),chrome.runtime.getManifest().version,encodeURIComponent(navigator.userAgent),encodeURIComponent(window.location.href));var n='<h2>Uh-oh! The SurfingKeys extension encountered a bug.</h2> <p>Please click <a href="https://github.com/brookhong/Surfingkeys/issues/new?title={0}&body={1}" target=_blank>here</a> to start filing a new issue, append a description of how you were using SurfingKeys before this message appeared, then submit it.  Thanks for your help!</p>'.format(e,t);Front.showPopup(n)}function scrollIntoViewIfNeeded(e,t){e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():isElementPartiallyInViewport(e,t)||e.scrollIntoView()}function isElementDrawn(e,t){var n=isEditable(e)?1:4;return t=t||e.getBoundingClientRect(),t.width>n&&t.height>n}function isElementPartiallyInViewport(e,t){var n=e.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;return(t||isElementDrawn(e,n))&&n.top<o&&n.bottom>0&&n.left<r&&n.right>0}function getVisibleElements(e){for(var t=Array.from(document.documentElement.getElementsByTagName("*")),n=[],o=0;o<t.length;o++){var r=t[o];if(r.shadowRoot)for(var i=r.shadowRoot.querySelectorAll("*"),s=0;s<i.length;s++)t.push(i[s]);var a=r.getBoundingClientRect();a.top<=window.innerHeight&&a.bottom>=0&&a.left<=window.innerWidth&&a.right>=0&&a.height>0&&"hidden"!==getComputedStyle(r).visibility&&e(r,n)}return n}function actionWithSelectionPreserved(e){var t=document.getSelection(),n=[t.type,t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset],o=document.scrollingElement.scrollTop;e(t),document.scrollingElement.scrollTop=o,"None"===n[0]?t.empty():"Caret"===n[0]?t.setPosition(n[3],n[4]):"Range"===n[0]&&(t.setPosition(n[1],n[2]),t.extend(n[3],n[4]))}function last(e){return e[e.length-1]}function filterAncestors(e){if(0===e.length)return e;for(var t=[last(e)],n=e.length-2;n>=0;n--)e[n].contains(last(t))&&!isExplicitlyRequested(e[n])||t.push(e[n]);return t.reverse()}function getRealRect(e){if(0===e.childElementCount){var t=e.getClientRects();return 3===t.length?t[1]:2===t.length?t[0]:e.getBoundingClientRect()}if(1===e.childElementCount&&e.firstElementChild.textContent){var t=e.firstElementChild.getBoundingClientRect();return 0!==t.width&&0!==t.height||(t=e.getBoundingClientRect()),t}return e.getBoundingClientRect()}function isExplicitlyRequested(e){return runtime.conf.clickableSelector&&e.matches(runtime.conf.clickableSelector)}function filterOverlapElements(e){e=e.filter(function(e){var t=getRealRect(e);if(e.disabled||e.readOnly||!isElementDrawn(e,t))return!1;if(e.matches("input, textarea, select, form")||"true"===e.contentEditable)return!0;var n=document.elementFromPoint(t.left+t.width/2,t.top+t.height/2);return!n||n.shadowRoot&&0===n.childElementCount||n.contains(e)||e.contains(n)});var t=null;return e=e.filter(function(e){var n=!0;return e.href&&(t=e),t&&t!==e&&t.contains(e)&&(n=!1),n}),filterAncestors(e)}function getTextNodes(e,t,n){var o=["script","style","noscript","surfingkeys_mark"],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){if(!e.data.trim()||!e.parentNode.offsetParent||o.indexOf(e.parentNode.localName.toLowerCase())!==-1||!t.test(e.data))return t.lastIndex=0,NodeFilter.FILTER_REJECT;var n=e.parentNode.getBoundingClientRect();return n.width<4||n.height<4?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}},!1),i=[];if(1===n)i.push(r.firstChild());else if(n===-1)i.push(r.lastChild());else{if(0===n)return r;if(2===n)for(;r.nextNode();)i.push(r.currentNode.parentNode);else for(;r.nextNode();)i.push(r.currentNode)}return i}function getTextNodePos(e,t,n){var o=document.getSelection();o.setBaseAndExtent(e,t,e,n?t+n:e.data.length);var r=o.getRangeAt(0).getClientRects()[0],i={left:-1,top:-1};return r&&r.height>0&&r.width>0&&(i.left=r.left,i.top=r.top,i.width=r.width,i.height=r.height),i}function initL10n(e){var t=runtime.conf.language||window.navigator.language;"en-US"===t?e(function(e){return e}):fetch(chrome.extension.getURL("pages/l10n.json")).then(function(e){return e.json()}).then(function(n){"object"===_typeof(n[t])?(n=n[t],e(function(e){return n[e]?n[e]:e})):e(function(e){return e})})}function _parseAnnotation(e){var t=e.annotation.match(/#(\d+)(.*)/);return null!==t&&(e.feature_group=parseInt(t[1]),e.annotation=t[2]),e}function _map(e,t,n){n=KeyboardUtils.encodeKeystroke(n);var o=e.mappings.find(n);if(o){t=KeyboardUtils.encodeKeystroke(t),e.mappings.remove(t);var r=Object.assign({},o.meta);e.mappings.add(t,r),isInUIFrame()||Front.addMapkey(e.name,t,n)}return o}function RUNTIME(e,t,n){var o=["closeTab","nextTab","previousTab","moveTab","reloadTab","setZoom","closeTabLeft","closeTabRight","focusTabByIndex"];(t=t||{}).action=e,o.indexOf(e)!==-1&&(t.repeats=RUNTIME.repeats,RUNTIME.repeats=1);try{t.needResponse=void 0!==n,chrome.runtime.sendMessage(t,n)}catch(r){Front.showPopup("[runtime exception] "+r)}}function getAnnotations(e){return e.getWords().map(function(t){var n=e.find(t).meta;return{word:t,feature_group:n.feature_group,annotation:n.annotation}}).filter(function(e){return e.annotation&&e.annotation.length>0})}function constructSearchURL(e,t){return e.indexOf("{0}")>0?e.format(t):e+t}function tabOpenLink(e,t){t=t||5;var n;n="Array"===e.constructor.name?e:e instanceof NodeList?Array.from(e).map(function(e){return e.href}):e.trim().split("\n"),n=n.map(function(e){return e.trim()}).filter(function(e){return e.length>0}),n.slice(0,t).forEach(function(e){RUNTIME("openLink",{tab:{tabbed:!0},url:e})}),n.length>t&&RUNTIME("queueURLs",{urls:n.slice(t)})}function getElements(e){return listElements(document.body,NodeFilter.SHOW_ELEMENT,function(t){return t.offsetHeight&&t.offsetWidth&&t.matches(e)})}function getClickableElements(e,t){var n=listElements(document.body,NodeFilter.SHOW_ELEMENT,function(n){return n.offsetHeight&&n.offsetWidth&&"pointer"===getComputedStyle(n).cursor&&(n.matches(e)||t.test(n.textContent))});return filterOverlapElements(n)}function filterInvisibleElements(e){return e.filter(function(e){return e.offsetHeight&&e.offsetWidth&&!e.getAttribute("disabled")&&isElementPartiallyInViewport(e)&&"hidden"!==getComputedStyle(e).visibility})}function setSanitizedContent(e,t){e.innerHTML=DOMPurify.sanitize(t)}function createElementWithContent(e,t,n){var o=document.createElement(e);if(t&&setSanitizedContent(o,t),n)for(var r in n)o.setAttribute(r,n[r]);return o}function hasScroll(e,t,n){var o="y"===t?["scrollTop","height"]:["scrollLeft","width"],r=e[o[0]];if(r<n){var i=e[o[0]];e[o[0]]=e.getBoundingClientRect()[o[1]],r=e[o[0]],r!==i&&Mode.suppressNextScrollEvent(),e[o[0]]=i}return r>=n}function isEmptyObject(e){for(var t in e)return!1;return!0}function htmlEncode(e){return _divForHtmlEncoder.innerText=e,_divForHtmlEncoder.innerHTML}function createObserver(){function e(e){for(;e!==document.body;){if("relative"===getComputedStyle(e).position)return!0;e=e.parentElement}return!1}var t={},n=new Promise(function(e,t){document.body?e(document.body):document.addEventListener("DOMContentLoaded",function(){e(document.body)})}),o=void 0,r=new MutationObserver(function(t){var n=[],r=!0,i=!1,s=void 0;try{for(var a,l=t[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var c=a.value,d=!0,u=!1,f=void 0;try{for(var p,h=c.addedNodes[Symbol.iterator]();!(d=(p=h.next()).done);d=!0){var m=p.value;m.nodeType!==Node.ELEMENT_NODE||m.fromSurfingKeys||(m.newlyCreated=!0,n.push(m))}}catch(g){u=!0,f=g}finally{try{!d&&h["return"]&&h["return"]()}finally{if(u)throw f}}}}catch(g){i=!0,s=g}finally{try{!r&&l["return"]&&l["return"]()}finally{if(i)throw s}}n.length&&(o&&(clearTimeout(o),o=void 0),o=setTimeout(function(){var t=getVisibleElements(function(t,n){var o=t.getBoundingClientRect();o.width>300&&o.height>300&&o.width<=window.innerWidth&&o.height<=window.innerHeight&&o.top>=0&&o.left>=0&&hasScroll(t,"y",16)&&e(t)&&n.push(t)});t.length&&Normal.addScrollableElement(t[0])},200))});return r.isConnected=!1,t.turnOnDOMObserver=function(){r.isConnected||n.then(function(e){r.observe(e,{childList:!0,subtree:!0}),r.isConnected=!0})},t.turnOffDOMObserver=function(){r.isConnected&&(r.disconnect(),r.isConnected=!1)},t}function createMode(){function e(e,t){t.sk_stopPropagation&&(t.stopImmediatePropagation(),t.preventDefault(),"keydown"===t.type&&e===Normal&&o.suppressKeyUp(t.keyCode))}function t(t,n,o){for(var i=0;i<r.length&&!n.sk_stopPropagation;i++){var s=r[i];if(!n.sk_suppressed&&s.eventListeners.hasOwnProperty(t)){var a=s.eventListeners[t];a(n),e(s,n)}if("Disabled"===s.name)break;o&&o(s)}}function n(){for(var e in s)window.addEventListener(e,s[e],!0)}var o=function l(e,n){this.name=e,this.statusLine=n,this.eventListeners={},this.addEventListener=function(e,n){return this.eventListeners[e]=n,s.hasOwnProperty(e)||(s[e]=function(n){t(e,n)},window.addEventListener(e,s[e],!0)),this},this.enter=function(e,t){var n=r.indexOf(this);if(this.priority||(this.priority=e||r.length),n===-1)r.unshift(this);else if(n>0)if(t)r=r.slice(n);else{var o=r.map(function(e){return e.name}).join(",");reportIssue("Mode {0} pushed into mode stack again.".format(this.name),"Modes in stack: {0}".format(o))}return r.sort(function(e,t){return e.priority<t.priority?1:t.priority<e.priority?-1:0}),this.onEnter&&this.onEnter(),l.showStatus(),n},this.exit=function(e){var t=r.indexOf(this);if(t!==-1)if(this.priority=0,e)r.splice(t,1);else{t++;r.slice(0,t);r=r.slice(t)}l.showStatus(),this.onExit&&this.onExit(t)}},r=[];o.specialKeys={"<Alt-s>":["<Alt-s>"],"<Esc>":["<Esc>"]},o.isSpecialKeyOf=function(e,t){return-1!==o.specialKeys[e].indexOf(KeyboardUtils.decodeKeystroke(t))};var i=[];o.suppressKeyUp=function(e){i.indexOf(e)===-1&&i.push(e)};var s={keydown:function(e){e.sk_keyName=KeyboardUtils.getKeyChar(e),t("keydown",e)},keyup:function(e){t("keyup",e,function(t){var n=i.indexOf(e.keyCode);n!==-1&&(e.stopImmediatePropagation(),i.splice(n,1))})},scroll:function(e){a>0&&(e.stopImmediatePropagation(),e.preventDefault(),a--)}},a=0;return o.suppressNextScrollEvent=function(){a++},o.destroy=function(){for(var e in s)window.removeEventListener(e,s[e],!0)},"about:blank"===window.location.href&&window.frameElement&&0===document.body.childElementCount?window.frameElement.addEventListener("load",function(e){try{n()}catch(t){console.log("Error on blank iframe loaded: "+t)}}):n(),o.showStatus=function(){if(document.hasFocus()&&r.length){var e=r[0],t=e.statusLine;if(void 0===t&&(t=runtime.conf.showModeStatus?e.name:""),""!==t&&window!==top)if(0===chrome.extension.getURL("").indexOf(window.location.origin))e!==Find&&(t+="âœ©");else{var n=window.location.pathname.split("/");n.length&&(t+=" - frame: "+n[n.length-1])}"object"===("undefined"==typeof Front?"undefined":_typeof(Front))&&Front.showStatus(0,t)}},o.stack=function(){return r},o.finish=function(e){var t=!1;return(e.map_node!==e.mappings||null!=e.pendingMap||e.repeats)&&(e.map_node=e.mappings,e.pendingMap=null,e.isTrustedEvent&&Front.hideKeystroke(),e.repeats&&(e.repeats=""),t=!0),t},o.handleMapKey=function(e,t){var n=this,r=e.sk_keyName;this.isTrustedEvent=e.isTrusted;var i=Mode.isSpecialKeyOf("<Esc>",r);if(i&&(r=KeyboardUtils.encodeKeystroke("<Esc>")),i&&o.finish(this))e.sk_stopPropagation=!0,e.sk_suppressed=!0;else if(this.pendingMap){this.setLastKeys&&this.setLastKeys(this.map_node.meta.word+r);var s=this.pendingMap.bind(this);e.sk_stopPropagation=!this.map_node.meta.stopPropagation||this.map_node.meta.stopPropagation(r),s(r),o.finish(n)}else if(void 0!==this.repeats&&this.map_node===this.mappings&&runtime.conf.digitForRepeat&&(r>="1"||""!==this.repeats&&r>="0")&&r<="9"&&this.map_node.getWords().length>0)this.repeats+=r,this.isTrustedEvent&&Front.showKeystroke(r,this),e.sk_stopPropagation=!0;else{var a=this.map_node;if(this.map_node=this.map_node.find(r),this.map_node)if(this.map_node.meta){var l=this.map_node.meta.code;if(l.length)this.pendingMap=l,this.isTrustedEvent&&Front.showKeystroke(r,this),e.sk_stopPropagation=!0;else{for(this.setLastKeys&&this.setLastKeys(this.map_node.meta.word),RUNTIME.repeats=parseInt(this.repeats)||1,e.sk_stopPropagation=!this.map_node.meta.stopPropagation||this.map_node.meta.stopPropagation(r);RUNTIME.repeats>0;)l(),RUNTIME.repeats--;o.finish(n)}}else this.isTrustedEvent&&Front.showKeystroke(r,this),e.sk_stopPropagation=!0;else t&&t(a),e.sk_suppressed=a!==this.mappings,o.finish(this)}},o}function createDisabled(){var e=new Mode("Disabled");return e.priority=99,e.addEventListener("keydown",function(t){t.sk_suppressed=!0,Mode.isSpecialKeyOf("<Alt-s>",t.sk_keyName)&&(Normal.toggleBlacklist(),e.exit(),t.sk_stopPropagation=!0)}),e}function createPassThrough(){var e,t,n=new Mode("PassThrough");return n.addEventListener("keydown",function(o){o.sk_suppressed=!0,Mode.isSpecialKeyOf("<Esc>",o.sk_keyName)?(n.exit(),o.sk_stopPropagation=!0):t>0&&(e&&(clearTimeout(e),e=void 0),e=setTimeout(function(){n.exit()},t))}).addEventListener("mousedown",function(e){e.sk_suppressed=!0}),n.addEventListener("focus",function(e){e.sk_suppressed=!0}),n.onEnter=function(){t>0?(e=setTimeout(function(){n.exit()},t),n.statusLine="ephemeral("+t+"ms) pass through"):n.statusLine="pass through"},n.setTimeout=function(e){t=e},n}function createNormal(){function e(e){e.skScrollBy=function(t,n){if(!runtime.conf.smartPageBoundary||this!==document.scrollingElement&&(1!==d.length||this!==d[0])||!(0===this.scrollTop&&n<=0&&previousPage()||this.scrollHeight-this.scrollTop<=this.clientHeight+1&&n>0&&nextPage()))if(RUNTIME.repeats>1&&(t=RUNTIME.repeats*t,n=RUNTIME.repeats*n,RUNTIME.repeats=0),runtime.conf.smoothScroll){var o=Math.max(100,20*Math.log(Math.abs(t||n)));e.smoothScrollBy(t,n,o)}else document.dispatchEvent(new CustomEvent("surfingkeys:scrollStarted")),e.scrollBy({behavior:"instant",left:t,top:n}),document.dispatchEvent(new CustomEvent("surfingkeys:scrollDone"))},e.smoothScrollBy=function(t,n,o){if(!f){var r=function h(t){if(0===d)return d=t,document.dispatchEvent(new CustomEvent("surfingkeys:scrollStarted")),window.requestAnimationFrame(h);var n=e[a],o=(t-d)*l/c;Math.abs(n+o-u)>=Math.abs(l)?(p=!0,f>runtime.conf.scrollFriction?(e[a]+=o,u=e[a]):f>0?f++:e[a]=u+l):e[a]+=o,d=t,f||e[a]!==n&&!p?window.requestAnimationFrame(h):(f=0,e.style.scrollBehavior="",document.dispatchEvent(new CustomEvent("surfingkeys:scrollDone")))},i=n?["scrollTop",n]:["scrollLeft",t],s=_slicedToArray(i,2),a=s[0],l=s[1],c=o,d=0,u=e[a],p=!1;f=1,e.style.scrollBehavior="auto",window.requestAnimationFrame(r)}},h.push(e)}function t(){d&&0!==d.length||(d=o(),p=0)}function n(e){var t=e.currentTarget;if(t.contains(e.target)){for(var n=d.lastIndexOf(e.target),o=d.length-1;o>=0&&n===-1;o--)d[o]!==document.body&&d[o].contains(e.target)&&(n=o);n!==-1&&(p=n)}}function o(){var e=listElements(document.body,NodeFilter.SHOW_ELEMENT,function(e){return hasScroll(e,"y",16)&&e.scrollHeight>200||hasScroll(e,"x",16)&&e.scrollWidth>200});return e.sort(function(e,t){return t.contains(e)?1:e.contains(t)?-1:t.scrollHeight*t.scrollWidth-e.scrollHeight*e.scrollWidth}),document.scrollingElement&&(document.scrollingElement.scrollHeight>window.innerHeight||document.scrollingElement.scrollWidth>window.innerWidth)&&e.unshift(document.scrollingElement),e.forEach(function(e){e.removeEventListener("mousedown",n),e.addEventListener("mousedown",n),e.dataset.hint_scrollable=!0}),e}function r(e){var t;t=document.scrollingElement===e?{top:0,left:0,width:window.innerWidth,height:window.innerHeight}:e.getBoundingClientRect(),Front.highlightElement({duration:200,rect:{top:t.top,left:t.left,width:t.width,height:t.height}})}function i(e){if(d=o(),d.length>0){p=(p+1)%d.length;var t=d[p];scrollIntoViewIfNeeded(t),e||r(t)}}function s(){RUNTIME("localData",{data:{lastKeys:u}})}function a(e){runtime.conf.mouseSelectToQuery.indexOf(window.origin)===-1||isElementClickable(e.target)||e.target.matches(".cm-matchhighlight")||setTimeout(Front.querySelectedWord,1)}var l=new Mode("Normal"),c=!1;l.passFocus=function(e){c=e},l.addEventListener("keydown",function(e){var t=getRealEdit(e);if(isEditable(t)&&e.isTrusted)if(Mode.isSpecialKeyOf("<Esc>",e.sk_keyName))t.blur(),Insert.exit();else if(runtime.conf.editableBodyCare&&t===document.body&&"i"!==e.key)l.statusLine="Press i to enter Insert mode",runtime.conf.showModeStatus=!0,e.sk_keyName.length&&Mode.handleMapKey.call(l,e);else{e.sk_stopPropagation=runtime.conf.editableBodyCare&&t===document.body&&"i"===e.key,e.sk_stopPropagation&&(Normal.passFocus(!0),t.focus());var n=!1;if(!isElementPartiallyInViewport(t)){for(var o=t;o!==document.documentElement&&!o.newlyCreated;)o=o.parentElement;n=o!==document.documentElement&&o.newlyCreated}n?(t.blur(),delete o.newlyCreated,Mode.handleMapKey.call(l,e)):Insert.enter(t,!0)}else Mode.isSpecialKeyOf("<Alt-s>",e.sk_keyName)?(l.toggleBlacklist(),Mode.finish(l),e.sk_stopPropagation=!0):e.sk_keyName.length&&Mode.handleMapKey.call(l,e)}),l.addEventListener("blur",function(e){f=0}),l.addEventListener("focus",function(e){if(Mode.showStatus(),runtime.conf.stealFocusOnLoad&&!isInUIFrame()){var t=getRealEdit(e);isEditable(t)&&(c||t.enableAutoFocus?runtime.conf.enableAutoFocus||(c=!1):(t.blur(),e.sk_stopPropagation=!0))}}),l.addEventListener("keyup",function(e){setTimeout(function(){f=0},0)}),l.addEventListener("mousedown",function(e){if("undefined"!=typeof Insert){runtime.conf.enableAutoFocus?l.passFocus(!0):l.passFocus(e.isTrusted);var t=getRealEdit(e);isEditable(t)?Insert.enter(t,!0):Insert.exit()}}),l.toggleBlacklist=function(){0!==document.location.href.indexOf(chrome.extension.getURL(""))?RUNTIME("toggleBlacklist",{blacklistPattern:runtime.conf.blacklistPattern?runtime.conf.blacklistPattern.toJSON():""},function(e){e.disabled?e.blacklist.hasOwnProperty(".*")?Front.showBanner("Surfingkeys is globally disabled, please enable it globally from popup menu.",3e3):Front.showBanner("Surfingkeys turned OFF for "+e.url,3e3):Front.showBanner("Surfingkeys turned ON for "+e.url,3e3)}):Front.showBanner("You could not toggle Surfingkeys on its own pages.",3e3)},l.passThrough=function(e){PassThrough.setTimeout(e),PassThrough.enter()},l.mappings=new Trie,l.map_node=l.mappings,l.repeats="";var d,u,f=0,p=0,h=[];l.scroll=function(n){t();var o=document.scrollingElement;if(d.length>0&&(o=d[p],o!==document.scrollingElement&&o!==document.body)){var r=o.getBoundingClientRect();0!==r.width&&0!==r.height&&isElementPartiallyInViewport(o)&&(hasScroll(o,"x",16)||hasScroll(o,"y",16))||(l.refreshScrollableElements(),o=d[p])}if(o){o.skScrollBy||e(o);var i=o===document.scrollingElement?[window.innerWidth,window.innerHeight]:[o.offsetWidth,o.offsetHeight];switch(n){case"down":o.skScrollBy(0,runtime.conf.scrollStepSize);break;case"up":o.skScrollBy(0,-runtime.conf.scrollStepSize);break;case"pageDown":o.skScrollBy(0,Math.round(i[1]/2));break;case"fullPageDown":o.skScrollBy(0,i[1]);break;case"pageUp":o.skScrollBy(0,-Math.round(i[1]/2));break;case"fullPageUp":o.skScrollBy(0,-i[1]);break;case"top":o.skScrollBy(0,-o.scrollTop);break;case"bottom":o.skScrollBy(o.scrollLeft,o.scrollHeight-o.scrollTop);break;case"left":o.skScrollBy(-Math.round(runtime.conf.scrollStepSize/2),0);break;case"right":o.skScrollBy(Math.round(runtime.conf.scrollStepSize/2),0);break;case"leftmost":o.skScrollBy(-o.scrollLeft-10,0);break;case"rightmost":o.skScrollBy(o.scrollWidth-o.scrollLeft-i[0]+20,0);break;case"byRatio":var s=parseInt(RUNTIME.repeats*o.scrollHeight/100)-i[1]/2-o.scrollTop;RUNTIME.repeats=0,o.skScrollBy(0,s)}window.Observer&&window.Observer.turnOffDOMObserver()}},l.refreshScrollableElements=function(){return d=null,t(),d},l.getScrollableElements=function(){return t(),d},l.addScrollableElement=function(e){d&&(e.contains(d[p])||d.indexOf(e)!==-1)||(t(),d.push(e),p=d.length-1)},l.rotateFrame=function(){RUNTIME("nextFrame")},l.feedkeys=function(e){setTimeout(function(){for(var t=new Event("keydown"),n=0;n<e.length;n++)t.sk_keyName=e[n],Mode.handleMapKey.call(l,t)},1)},l.setLastKeys=function(e){!this.map_node.meta.repeatIgnore&&e.length>1&&(u=[e],s())},l.appendKeysForRepeat=function(e,t){u&&u.length>0&&(u.push("{0}\t{1}".format(e,t)),s())},l.repeatLast=function(){u=runtime.conf.lastKeys,l.feedkeys(u[0]);for(var e=u.slice(1),t=0;t<e.length;t++){var n=e[t].split("\t");if("Hints"===n[0]){var o=function(){var e=n[1];return function(){Hints.feedkeys(e)}};setTimeout(o(),120+100*t)}}},l.addVIMark=function(e,t){t=t||window.location.href;var n={};n[e]={url:t,scrollLeft:document.scrollingElement.scrollLeft,scrollTop:document.scrollingElement.scrollTop},RUNTIME("addVIMark",{mark:n}),Front.showBanner("Mark '{0}' added for: {1}.".format(e,t))},l.jumpVIMark=function(e){RUNTIME("jumpVIMark",{mark:e})},l.insertJS=function(e,t){var n=document.createElement("script");n.type="text/javascript","function"==typeof e?(setSanitizedContent(n,"("+e.toString()+")(window);"),setTimeout(function(){t&&t(),n.remove()},1)):(n.src=e,n.onload=function(){t&&t(),n.remove()}),document.lastElementChild.appendChild(n)},l.moveTab=function(e){RUNTIME("moveTab",{position:e})},l.captureElement=function(e){RUNTIME("getCaptureSize",null,function(t){var n=t.width/window.innerWidth;e.scrollTop=0,e.scrollLeft=0;var o=-1,r=-1,i=e.style.overflowY;e.style.overflowY="hidden";var s=e.style.overflowX;e.style.overflowX="hidden";var a=e.style.borderStyle;e.style.borderStyle="none",Front.toggleStatus(!1);var l,c,d,u,f,p,h=0,m=0,g=e.scrollHeight,v=e.scrollWidth;if(e===document.scrollingElement)f=window.innerWidth,p=window.innerHeight,l=0,c=0;else{var y=e.getBoundingClientRect(),w=[Math.max(y.left,0),Math.max(y.top,0),Math.min(y.right,window.innerWidth),Math.min(y.bottom,window.innerHeight)];f=w[2]-w[0],p=w[3]-w[1],l=w[0]*n,c=w[1]*n}d=f*n,u=p*n;var b=document.createElement("canvas");b.width=v*n,b.height=g*n;var E=b.getContext("2d"),y=e.getBoundingClientRect(),k=document.createElement("img");k.onload=function(){E.drawImage(k,l,c,d,u,h,m,d,u),o===e.scrollTop?r===e.scrollLeft?(Front.toggleStatus(!0),Front.showPopup("<img src='{0}' />".format(b.toDataURL("image/png"))),e.style.overflowY=i,e.style.overflowX=s,e.style.borderStyle=a):(o=-1,e.scrollTop=0,m=0,r=e.scrollLeft,e.scrollLeft+2*f<v?(e.scrollLeft+=f,h+=f*n):(e.scrollLeft+=v%f,h=e.scrollLeft*n),setTimeout(function(){RUNTIME("captureVisibleTab",null,function(e){k.src=e.dataUrl})},100)):(o=e.scrollTop,e.scrollTop+2*p<g?(e.scrollTop+=p,m+=p*n):(e.scrollTop+=g%p,m=e.scrollTop*n),setTimeout(function(){RUNTIME("captureVisibleTab",null,function(e){k.src=e.dataUrl})},100))},setTimeout(function(){RUNTIME("captureVisibleTab",null,function(e){k.src=e.dataUrl})},500)})},l.mappings.add("yG",{annotation:"Capture current full page",feature_group:7,code:function(){l.captureElement(document.scrollingElement)}}),l.mappings.add("yS",{annotation:"Capture scrolling element",feature_group:7,code:function(){var e=document.scrollingElement;t(),d.length>0&&(e=d[p]),l.captureElement(e)}}),l.mappings.add("cS",{annotation:"Reset scroll target",feature_group:2,code:function(){if(d=null,t(),d.length>0){var e=d[p];r(e)}}}),l.mappings.add("e",{annotation:"Scroll half page up",feature_group:2,repeatIgnore:!0,code:l.scroll.bind(l,"pageUp")}),l.mappings.add("d",{annotation:"Scroll half page down",feature_group:2,repeatIgnore:!0,code:l.scroll.bind(l,"pageDown")}),l.mappings.add("gg",{annotation:"Scroll to the top of the page",feature_group:2,repeatIgnore:!0,code:l.scroll.bind(l,"top")}),l.mappings.add("G",{annotation:"Scroll to the bottom of the page",feature_group:2,repeatIgnore:!0,code:l.scroll.bind(l,"bottom")}),l.mappings.add("j",{annotation:"Scroll down",feature_group:2,repeatIgnore:!0,code:l.scroll.bind(l,"down")}),l.mappings.add("k",{annotation:"Scroll up",feature_group:2,repeatIgnore:!0,code:l.scroll.bind(l,"up")}),l.mappings.add("h",{annotation:"Scroll left",feature_group:2,repeatIgnore:!0,code:l.scroll.bind(l,"left")}),l.mappings.add("l",{annotation:"Scroll right",feature_group:2,repeatIgnore:!0,code:l.scroll.bind(l,"right")}),l.mappings.add("0",{annotation:"Scroll all the way to the left",feature_group:2,repeatIgnore:!0,code:l.scroll.bind(l,"leftmost")}),l.mappings.add("$",{annotation:"Scroll all the way to the right",feature_group:2,repeatIgnore:!0,code:l.scroll.bind(l,"rightmost")}),l.mappings.add("%",{annotation:"Scroll to percentage of current page",feature_group:2,repeatIgnore:!0,code:l.scroll.bind(l,"byRatio")}),l.mappings.add("cs",{annotation:"Change scroll target",feature_group:2,repeatIgnore:!0,code:function(){i()}}),l.mappings.add("f",{annotation:"Open a link, press SHIFT to flip overlapped hints, hold SPACE to hide hints",feature_group:1,repeatIgnore:!0,code:function(){Hints.create("",Hints.dispatchMouseClick)}}),l.mappings.add(";fs",{annotation:"Display hints to focus scrollable elements",feature_group:1,repeatIgnore:!0,code:function(){Hints.create(Normal.refreshScrollableElements(),Hints.dispatchMouseClick)}}),l.mappings.add("v",{annotation:"Toggle visual mode",feature_group:9,repeatIgnore:!0,code:function(){Visual.toggle()}}),l.mappings.add("cq",{annotation:"Query word with Hints",feature_group:7,repeatIgnore:!0,code:function(){Visual.toggle("q")}}),l.mappings.add("/",{annotation:"Find in current page",feature_group:9,repeatIgnore:!0,code:function(){Front.openFinder()}}),l.mappings.add("n",{annotation:"Next found text",feature_group:9,repeatIgnore:!0,code:function(){Visual.next(!1)}}),l.mappings.add("N",{annotation:"Previous found text",feature_group:9,repeatIgnore:!0,code:function(){Visual.next(!0)}}),l.mappings.add("E",{annotation:"Go one tab left",feature_group:3,repeatIgnore:!0,code:function(){
RUNTIME("previousTab")}}),l.mappings.add("R",{annotation:"Go one tab right",feature_group:3,repeatIgnore:!0,code:function(){RUNTIME("nextTab")}});var m=null;return l.disable=function(){m||(m=createDisabled(),m.enter(0,!0)),window.Observer&&window.Observer.turnOffDOMObserver(),document.removeEventListener("mouseup",a)},l.enable=function(){m&&(m.exit(),m=null),document.addEventListener("mouseup",a)},l.enable(),l.onExit=function(){window.Observer&&window.Observer.turnOffDOMObserver(),h.forEach(function(e){delete e.skScrollBy,delete e.smoothScrollBy})},l}function createInsert(){function e(){var e=getRealEdit();if(void 0!==e.setSelectionRange)try{e.setSelectionRange(e.value.length,e.value.length)}catch(t){if(!(t instanceof DOMException&&"InvalidStateError"===t.name))throw t}else if(isEditable(e)&&e.childNodes.length>0){var n=e.childNodes[e.childNodes.length-1];n.nodeType===Node.TEXT_NODE?document.getSelection().setPosition(n,n.data.length):document.getSelection().setPosition(n,n.childNodes.length),Visual.showCursor(),Visual.hideCursor()}}function t(){var e=getRealEdit(),t="",o=!0;if(void 0!==e.selectionStart&&void 0!==e.value)t=e.value.substr(c,e.selectionStart-c);else{o=!1;var r=document.getSelection();t=r.focusNode.data.substr(c,r.focusOffset-c)}if(t.length<runtime.conf.startToShowEmoji||" "===t[0])l.remove();else{var i=a.filter(function(e){return e.indexOf(t)!==-1}).slice(0,5).map(function(e){var t=e.split("\t"),n=String.fromCodePoint.apply(null,t[0].split(","));return"<div><span>{0}</span>{1}</div>".format(n,t[1])}).join("");if(""===i)l.remove();else{setSanitizedContent(l,i),document.body.append(l),l.style.display="",l.querySelector("#sk_emoji>div").classList.add("selected");var s;o?s=n(e):(Visual.showCursor(),s=Visual.getCursorPixelPos(),Visual.hideCursor());var d=s.top+s.height+4;window.innerHeight-d<l.offsetHeight&&(d=s.top-l.offsetHeight),l.style.position="fixed",l.style.top=d+"px",l.style.left=s.left+"px"}}}function n(e){var t=getComputedStyle(e),n=e.getBoundingClientRect(),o=document.createElement("div"),r=document.createElement("span");o.style.font=t.font,o.style.position="fixed",setSanitizedContent(o,e.value),o.style.left=e.clientLeft+n.left+"px",o.style.top=e.clientTop+n.top+"px",o.style.color="red",o.style.overflow="scroll",o.style.visibility="hidden",o.style.whiteSpace="pre-wrap",o.style.padding=t.padding,o.style.width=t.width,o.style.height=t.height,r.innerText="I";var i=e.selectionStart;if(i===e.value.length)o.appendChild(r);else{var s=o.childNodes[0].splitText(i);o.insertBefore(r,s)}return document.body.appendChild(o),scrollIntoViewIfNeeded(r),n=r.getBoundingClientRect(),o.remove(),n}function o(e){var t=l.querySelector("#sk_emoji>div.selected"),n=Array.from(l.querySelectorAll("#sk_emoji>div")),o=(n.indexOf(t)+(e?-1:1))%n.length;t.classList.remove("selected"),n[o].classList.add("selected")}function r(e,t,n){var o=/\W/;for(n=t>0?n:n+t;;){if(n<0){n=0;break}if(n>=e.length){n=e.length;break}if(o.test(e[n]))break;n+=t}return n}function i(e,t,n){var o=r(e,t,n),i=e;return i=o>n?e.substr(0,n)+e.substr(o):o<n?e.substr(0,o)+e.substr(n):e.substr(0,o)+e.substr(o+1),[i,t>0?n:o]}var s=new Mode("Insert");s.mappings=new Trie,s.map_node=s.mappings,s.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-e>"),{annotation:"Move the cursor to the end of the line",feature_group:15,code:e}),s.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-f>"),{annotation:"Move the cursor to the beginning of the line",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange)e.setSelectionRange(0,0);else{var t=document.getSelection();t.setPosition(t.focusNode,0),Visual.showCursor(),Visual.hideCursor()}}}),s.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-u>"),{annotation:"Delete all entered characters before the cursor",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange)e.value=e.value.substr(e.selectionStart),e.setSelectionRange(0,0);else{var t=document.getSelection();t.focusNode.data=t.focusNode.data.substr(t.focusOffset)}}}),s.mappings.add(KeyboardUtils.encodeKeystroke("<Alt-b>"),{annotation:"Move the cursor Backward 1 word",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange){var t=r(e.value,-1,e.selectionStart);e.setSelectionRange(t,t)}else document.getSelection().modify("move","backward","word")}}),s.mappings.add(KeyboardUtils.encodeKeystroke("<Alt-f>"),{annotation:"Move the cursor Forward 1 word",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange){var t=r(e.value,1,e.selectionStart);e.setSelectionRange(t,t)}else document.getSelection().modify("move","forward","word")}}),s.mappings.add(KeyboardUtils.encodeKeystroke("<Alt-w>"),{annotation:"Delete a word backwards",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange){var t=i(e.value,-1,e.selectionStart);e.value=t[0],e.setSelectionRange(t[1],t[1])}else{var n=document.getSelection(),o=n.focusOffset;document.getSelection().modify("move","backward","word");var r=n.focusNode.data,s=n.focusOffset;n.focusNode.data=r.substr(0,s)+r.substr(o),n.setPosition(n.focusNode,s)}}}),s.mappings.add(KeyboardUtils.encodeKeystroke("<Alt-d>"),{annotation:"Delete a word forwards",feature_group:15,code:function(){var e=getRealEdit();if(void 0!==e.setSelectionRange){var t=i(e.value,1,e.selectionStart);e.value=t[0],e.setSelectionRange(t[1],t[1])}else{var n=document.getSelection(),o=n.focusOffset;document.getSelection().modify("move","forward","word");var r=n.focusNode.data,s=n.focusOffset;n.focusNode.data=r.substr(0,o)+r.substr(s),n.setPosition(n.focusNode,o)}}}),s.mappings.add(KeyboardUtils.encodeKeystroke("<Esc>"),{annotation:"Exit insert mode",feature_group:15,stopPropagation:function(e){return e.charCodeAt(0)<256},code:function(){getRealEdit().blur(),s.exit()}});var a,l=createElementWithContent("div","",{id:"sk_emoji",style:"display: block; opacity: 1;"}),c=-1;s.mappings.add(":",{annotation:"Input emoji",feature_group:15,stopPropagation:function(){return!1},code:function(){var e=getRealEdit();c=void 0!==e.selectionStart?e.selectionStart+1:document.getSelection().focusOffset+1,fetch(chrome.extension.getURL("pages/emoji.tsv")).then(function(e){return Promise.all([e.text()])}).then(function(e){a=e[0].split("\n"),t()})}});var d=!1;s.addEventListener("keydown",function(e){if(e.key&&e.key.charCodeAt(0)>127)return void(e.sk_suppressed=!0);var t=getRealEdit(e);if(l.offsetHeight>0){if(Mode.isSpecialKeyOf("<Esc>",e.sk_keyName))l.remove(),c=-1;else if(e.keyCode===KeyboardUtils.keyCodes.tab||e.keyCode===KeyboardUtils.keyCodes.upArrow||e.keyCode===KeyboardUtils.keyCodes.downArrow)o(e.shiftKey||e.keyCode===KeyboardUtils.keyCodes.upArrow),d=!0,e.sk_stopPropagation=!0;else if(e.keyCode===KeyboardUtils.keyCodes.enter){var n=l.querySelector("#sk_emoji>div.selected>span").innerHTML;if(void 0!==t.setSelectionRange){var r=t.value;t.value=r.substr(0,c-1)+n+r.substr(t.selectionStart),t.setSelectionRange(c,c)}else{var i=document.getSelection(),r=i.focusNode.data;i.focusNode.data=r.substr(0,c-1)+n+r.substr(i.focusOffset),i.setPosition(i.focusNode,c)}l.remove(),c=-1,e.sk_stopPropagation=!0}}else isEditable(t)?e.sk_keyName.length&&Mode.handleMapKey.call(s,e,function(e){var t=e.getPrefixWord();if(t){var n=getRealEdit(),o=n.value,r=n.selectionStart;if(void 0!==o&&void 0!==r)n.value=o.substr(0,n.selectionStart)+t+o.substr(n.selectionEnd),r+=t.length,n.setSelectionRange(r,r);else{n=document.getSelection();var i=n.getRangeAt(0),s=document.createTextNode(t);"Caret"===n.type?(o=n.focusNode.data,void 0===o?(i.insertNode(s),n.setPosition(s,s.length)):(r=n.focusOffset,n.focusNode.data=o.substr(0,r)+t+o.substr(r),n.setPosition(n.focusNode,r+t.length))):(i.deleteContents(),i.insertNode(s),n.setPosition(s,s.length))}}}):s.exit();e.sk_suppressed=!0}),s.addEventListener("keyup",function(e){var n=getRealEdit(e);if(!d&&c!==-1){var o,r;if(void 0!==n.selectionStart&&void 0!==n.value)o=n.value,r=n.selectionStart;else{var i=document.getSelection();o=i.focusNode.data,r=i.focusOffset}r<c||":"!==o[c-1]?l.remove():t()}d=!1}),s.addEventListener("focus",function(e){var t=getRealEdit(e);e.target==window||isEditable(t)?e.sk_suppressed=!0:s.exit()});var u,f=s.enter;return s.enter=function(t,n){t===document.body&&(runtime.conf.showModeStatus=!1);var o=f.call(s)===-1;u!==t&&(u=t,o=!0),o&&!n&&runtime.conf.cursorAtEndOfInput&&"SELECT"!==t.nodeName&&e()},s}function createVisual(){function e(e){if(window.navigator.userAgent.indexOf("Firefox")===-1||"p"!==e&&"s"!==e){var t=g[e];w.modify("move","backward",t),w.modify("extend","forward",t)}}function t(e,t){Hints.flashPressedLink(e),dispatchMouseEvent(e,["click"],t)}function n(e,t){m.hideCursor();var n=[w.anchorNode,w.anchorOffset];if(w.focusNode&&w.focusNode.textContent&&w.focusNode.textContent.length&&w.focusNode.textContent[w.focusOffset]===t&&1===e&&w.setPosition(w.focusNode,w.focusOffset+1),h(t,!0,e===-1))if(1===E)w.setPosition(w.focusNode,w.focusOffset-1);else{var o=[w.focusNode,w.focusOffset-1];w.collapseToStart(),w.setPosition(n[0],n[1]),w.extend(o[0],o[1])}else w.setPosition(n[0],n[1]);m.showCursor()}function o(e){for(var t=null,n=getTextNodes(document.body,/./,0);n.nextNode();){var o=n.currentNode.parentNode.getBoundingClientRect();if(o.top>window.innerHeight*e){t=n.currentNode;break}}return t}function r(e,t){var n=e,o=/\W/;t<0?t=0:t>=e.length&&(t=e.length-1);var r=!0;if(o.test(e[t])){var i=0;for(r=!1;!r&&(t>i||t+i<e.length);)i++,r=t-i>=0&&!o.test(e[t-i])||t+i<e.length&&!o.test(e[t+i]);t=t-i>=0&&!o.test(e[t-i])?t-i:t+i}if(r){for(var s=t,a=t;s>=0&&!o.test(e[s]);)s--;for(;a<e.length&&!o.test(e[a]);)a++;n=e.substr(s+1,a-s-1)}return n}function i(){return T.setStart(arguments[0],arguments[1]),arguments.length>3?T.setEnd(arguments[2],arguments[3]):T.setEnd(arguments[0],arguments[1]),T.getBoundingClientRect()}function s(e){m.hideCursor(),w.anchorNode&&2===E?w.extend(e[0],e[1]):w.setPosition(e[0],e[1]),m.showCursor()}function a(){var e=m.map_node.meta.annotation.split(" "),t=2===E?"extend":"move";m.hideCursor();var n=[w.focusNode,w.focusOffset];w.modify(t,e[0],e[1]),n[0]===w.focusNode&&n[1]===w.focusOffset&&w.modify(t,e[0],"word"),m.showCursor()}function l(e,t,n,o){var r=i(e,t,n,o);if(r.width>0&&r.height>0){var s=C.cloneNode(!1);s.style.position="absolute",s.style.zIndex=2147483298,s.style.left=document.scrollingElement.scrollLeft+r.left+"px",s.style.top=document.scrollingElement.scrollTop+r.top+"px",s.style.width=r.width+"px",s.style.height=r.height+"px",_.appendChild(s),document.documentElement.contains(_)||document.documentElement.prepend(_),b.push([e,t,s])}}function c(e){if(getTextNodes(document.body,e).forEach(function(t){for(var n;null!==(n=e.exec(t.data));){var o=n[0];if(!o.length)break;var r=e.lastIndex-o.length;l(t,r,t,r+o.length)}}),0===b.length)for(w.setPosition(null,0);h(e.source,e.flags.indexOf("i")===-1,!1);)w.anchorNode!==w.focusNode&&l(w.anchorNode,w.anchorOffset,w.focusNode,w.focusOffset);if(b.length){y=0;for(var t=0;t<b.length;t++){var n=b[t][2].getBoundingClientRect();if(n.top>0){y=t;break}}Front.showStatus(2,y+1+" / "+b.length)}}function d(){Front.hideBubble()}function u(){m.mappings.add("y",v[E]),m.statusLine=m.name+" - "+k[E],Mode.showStatus()}function f(){E=(E+1)%3,u()}function p(e,t){var n="";return actionWithSelectionPreserved(function(o){o.setPosition(e,t),o.modify("extend","backward","sentence"),o.collapseToStart(),o.modify("extend","forward","sentence"),n=o.toString()}),n.replace(/\n/g,"")}function h(e,t,n){for(var o=!1,r=null;window.find(e,t,n);){if(w.anchorNode.splitText){o=!0;break}if(null===r)r=w.anchorNode;else if(r===w.anchorNode)break}return o}var m=new Mode("Visual");m.addEventListener("keydown",function(e){if(x){var t=!1;e.sk_stopPropagation=!0,e.sk_suppressed=!0,KeyboardUtils.isWordChar(e)?(n(x,e.sk_keyName),N=[x,e.sk_keyName],t=!0):Mode.isSpecialKeyOf("<Esc>",e.sk_keyName)&&(t=!0),t&&(m.statusLine=m.name+" - "+k[E],Mode.showStatus(),x=0)}else e.sk_keyName.length&&(Mode.handleMapKey.call(m,e),e.sk_stopPropagation?e.sk_suppressed=!0:Mode.isSpecialKeyOf("<Esc>",e.sk_keyName)&&(E>1?(m.hideCursor(),w.collapse(w.anchorNode,w.anchorOffset),m.showCursor()):(m.visualClear(),m.exit()),E--,u(),e.sk_stopPropagation=!0,e.sk_suppressed=!0))}),m.addEventListener("click",function(e){switch(w.type){case"None":m.hideCursor(),E=0;break;case"Caret":E&&(m.hideCursor(),0===E&&(E=1),m.showCursor());break;case"Range":E&&(m.hideCursor(),E=2,m.showCursor())}u()}),m.mappings=new Trie,m.map_node=m.mappings,m.repeats="",m.mappings.add("l",{annotation:"forward character",feature_group:9,code:a}),m.mappings.add("h",{annotation:"backward character",feature_group:9,code:a}),m.mappings.add("j",{annotation:"forward line",feature_group:9,code:a}),m.mappings.add("k",{annotation:"backward line",feature_group:9,code:a}),m.mappings.add("w",{annotation:"forward word",feature_group:9,code:a}),m.mappings.add("e",{annotation:"forward word",feature_group:9,code:a}),m.mappings.add("b",{annotation:"backward word",feature_group:9,code:a}),m.mappings.add(")",{annotation:"forward sentence",feature_group:9,code:a}),m.mappings.add("(",{annotation:"backward sentence",feature_group:9,code:a}),m.mappings.add("}",{annotation:"forward paragraphboundary",feature_group:9,code:a}),m.mappings.add("{",{annotation:"backward paragraphboundary",feature_group:9,code:a}),m.mappings.add("0",{annotation:"backward lineboundary",feature_group:9,code:a}),m.mappings.add("$",{annotation:"forward lineboundary",feature_group:9,code:a}),m.mappings.add("G",{annotation:"forward documentboundary",feature_group:9,code:function(){document.scrollingElement.scrollTop=document.scrollingElement.scrollHeight,window.navigator.userAgent.indexOf("Firefox")===-1?a():(m.hideCursor(),w.setPosition(document.body.lastChild,0),m.showCursor()),b.length&&(y=b.length-1,Front.showStatus(2,y+1+" / "+b.length))}}),m.mappings.add("gg",{annotation:"backward documentboundary",feature_group:9,code:function(){document.scrollingElement.scrollTop=0,y=0,b.length&&Front.showStatus(2,y+1+" / "+b.length),window.navigator.userAgent.indexOf("Firefox")===-1?a():(m.hideCursor(),w.setPosition(document.body.firstChild,0),m.showCursor())}}),m.mappings.add("o",{annotation:"Go to Other end of highlighted text",feature_group:9,code:function(){m.hideCursor();var e=[w.anchorNode,w.anchorOffset];w.collapse(w.focusNode,w.focusOffset),w.extend(e[0],e[1]),m.showCursor()}});var g={w:"word",l:"lineboundary",s:"sentence",p:"paragraphboundary"},v=[{},{annotation:"Yank a word(w) or line(l) or sentence(s) or paragraph(p)",feature_group:9,code:function(t){var n=[w.focusNode,w.focusOffset];m.hideCursor(),e(t),Clipboard.write(w.toString()),w.collapseToStart(),w.setPosition(n[0],n[1]),m.showCursor()}},{annotation:"Copy selected text",feature_group:9,code:function(){var e=[w.focusNode,w.focusOffset];Clipboard.write(w.toString()),"Caret"===runtime.conf.modeAfterYank?(w.setPosition(e[0],e[1]),m.showCursor(),E=1,u()):"Normal"===runtime.conf.modeAfterYank&&(E=2,m.toggle())}}];m.mappings.add("*",{annotation:"Search word under the cursor",feature_group:9,code:function(){m.star()}}),m.mappings.add(KeyboardUtils.encodeKeystroke("<Enter>"),{annotation:"Click on node under cursor.",feature_group:9,code:function(){t(w.focusNode.parentNode,!1)}}),m.mappings.add(KeyboardUtils.encodeKeystroke("<Shift-Enter>"),{annotation:"Click on node under cursor.",feature_group:9,code:function(){t(w.focusNode.parentNode,!0)}}),m.mappings.add("zz",{annotation:"make cursor at center of window.",feature_group:9,code:function(){var e=S.getBoundingClientRect().top-window.innerHeight/2;m.hideCursor(),document.scrollingElement.scrollTop+=e,m.showCursor()}}),m.mappings.add("f",{annotation:"Forward to next char.",feature_group:9,code:function(){m.statusLine=m.name+" - "+k[E]+" - forward",Mode.showStatus(),x=1}}),m.mappings.add("F",{annotation:"Backward to next char.",feature_group:9,code:function(){m.statusLine=m.name+" - "+k[E]+" - backward",Mode.showStatus(),x=-1}}),m.mappings.add(";",{annotation:"Repeat latest f, F",feature_group:9,code:function(){N&&n(N[0],N[1])}}),m.mappings.add(",",{annotation:"Repeat latest f, F in opposite direction",feature_group:9,code:function(){N&&n(-N[0],N[1])}}),m.mappings.add("p",{annotation:"Expand selection to parent element",feature_group:9,code:function(){for(var e=w.focusNode;e!==document.body;){e=e.parentElement;var t=getTextNodes(e,/./),n=t[t.length-1],o=w.getRangeAt(0);if(o.comparePoint(t[0],0)===-1||1===o.comparePoint(n,n.length)){m.hideCursor(),E=2,u(),w.setBaseAndExtent(t[0],0,n,n.length),m.showCursor();break}}}}),m.mappings.add("q",{annotation:"Translate word under cursor",feature_group:9,code:function(){var e=Visual.getWordUnderCursor();readText(e),Front.performInlineQuery(e,function(e){var t=S.getBoundingClientRect();Front.showBubble({left:t.left,top:t.top,height:t.height,width:t.width},e,!0)})}}),m.mappings.add("V",{annotation:"Select a word(w) or line(l) or sentence(s) or paragraph(p)",feature_group:9,code:function(t){m.hideCursor(),E=2,u(),e(t),m.showCursor()}});var y,w=document.getSelection(),b=[],E=0,k=["","Caret","Range"],C=document.createElement("surfingkeys_mark"),S=document.createElement("div");S.className="surfingkeys_cursor",S.style.zIndex=2147483298;var x=0,N=null;m.hideCursor=function(){document.body.contains(S)&&(S.remove(),document.dispatchEvent(new CustomEvent("surfingkeys:cursorHidden")))};var T=document.createRange();m.showCursor=function(){if(w.focusNode&&(w.focusNode.offsetHeight>0||w.focusNode.parentNode.offsetHeight>0)){scrollIntoViewIfNeeded(w.focusNode.parentElement,!0);var e=i(w.focusNode,w.focusOffset);S.style.position="fixed",S.style.left=e.left+"px",e.left<0||e.left>=window.innerWidth?(document.scrollingElement.scrollLeft+=e.left-window.innerWidth/2,S.style.left=window.innerWidth/2+"px"):S.style.left=e.left+"px",e.top<0||e.top>=window.innerHeight?(document.scrollingElement.scrollTop+=e.top-window.innerHeight/2,S.style.top=window.innerHeight/2+"px"):S.style.top=e.top+"px",S.style.height=e.height+"px",S.style.width=e.width+"px",document.body.appendChild(S)}},m.getCursorPixelPos=function(){return S.getBoundingClientRect()};var _=document.createElement("div");m.visualClear=function(){m.hideCursor(),b=[],M.forEach(function(e){e.onscroll=null}),M=[],setSanitizedContent(_,""),_.remove(),Front.showStatus(2,"")},m.onEnter=function(){document.addEventListener("surfingkeys:cursorHidden",d),f()},m.onExit=function(){document.removeEventListener("surfingkeys:cursorHidden",d)},m.restore=function(){w&&w.anchorNode&&(w.setPosition(w.anchorNode,w.anchorOffset),m.showCursor(),m.enter())},m.toggle=function(e){switch(E){case 1:w.extend(w.anchorNode,w.anchorOffset),f();break;case 2:m.hideCursor(),w.collapse(w.focusNode,w.focusOffset),m.exit(),f();break;default:if("ym"===e){var t=[];Hints.create(runtime.conf.textAnchorPat,function(e){t.push(e[2].trim()),Clipboard.write(t.join("\n"))},{multipleHits:!0})}else Hints.create(runtime.conf.textAnchorPat,function(t){if("y"===e)Clipboard.write(0===t[1]?t[0].data.trim():t[2].trim());else if("q"===e){var n=t[2].trim().replace(/[^A-z].*$/,""),o=getTextNodePos(t[0],t[1],t[2].length);void 0!==document.dictEnabled?window.postMessage({type:"OpenDictoriumQuery",word:n,sentence:p(t[0],t[1]),pos:o,source:window.location.href}):Front.performInlineQuery(n,function(e){Front.showBubble({top:o.top,left:o.left,height:o.height,width:o.width},e,!1)})}else setTimeout(function(){w.setPosition(t[0],t[1]),m.enter(),"z"===e&&(w.extend(t[0],t[1]+t[2].length),f()),m.showCursor()},0)})}},m.star=function(){if(w.focusNode&&w.focusNode.nodeValue){var e=m.getWordUnderCursor();if(e.length&&"."!==e){m.hideCursor();var t=[w.focusNode,w.focusOffset];runtime.updateHistory("find",e),m.visualClear(),c(new RegExp(e,"g"+(runtime.getCaseSensitive(e)?"":"i"))),w.setPosition(t[0],t[1]),m.showCursor()}}},m.getWordUnderCursor=function(){var e=w.toString();if(0===e.length&&w.focusNode){var t=w.focusNode;e=r(t.textContent,w.focusOffset)}return e},m.next=function(e){b.length?(0===E&&m.enter(),y=(e?b.length+y-1:y+1)%b.length,s(b[y]),Front.showStatus(2,y+1+" / "+b.length)):runtime.conf.lastQuery&&(c(new RegExp(runtime.conf.lastQuery,"g"+(runtime.getCaseSensitive(runtime.conf.lastQuery)?"":"i"))),m.visualEnter(runtime.conf.lastQuery))},m.feedkeys=function(e){setTimeout(function(){for(var t=new Event("keydown"),n=0;n<e.length;n++)t.sk_keyName=e[n],Mode.handleMapKey.call(m,t)},1)},m.visualUpdateForContentWindow=function(e){m.visualClear(),w.setPosition(o(0),0);var t=document.scrollingElement.scrollTop,n=[w.anchorNode,w.anchorOffset],r=runtime.getCaseSensitive(e);if(h(e,r,!1)?w.setPosition(n[0],n[1]):w.setPosition(document.body.firstChild,0),h(e,r,!1)){for(document.scrollingElement.scrollTop!==t&&(t=document.scrollingElement.scrollTop,n=[w.anchorNode,w.anchorOffset]),l(w.anchorNode,w.anchorOffset,w.focusNode,w.focusOffset);document.scrollingElement.scrollTop===t&&h(e,r,!1);)l(w.anchorNode,w.anchorOffset,w.focusNode,w.focusOffset);document.scrollingElement.scrollTop=t,w.setPosition(n[0],n[1])}},m.visualUpdate=function(e){e.length&&"."!==e&&(m.visualClear(),c(new RegExp(e,"g"+(runtime.getCaseSensitive(e)?"":"i"))))};var M=[];m.visualEnter=function(e){0!==e.length&&"."!==e&&(m.visualClear(),c(new RegExp(e,"g"+(runtime.getCaseSensitive(e)?"":"i"))),b.length?(m.enter(),s(b[y])):Front.showStatus(2,"Pattern not found: {0}".format(e),1e3),Normal.getScrollableElements().forEach(function(e){e!==document.scrollingElement&&(e.onscroll=function(){b.forEach(function(e){var t=i(e[0],e[1]);e[2].style.left=document.scrollingElement.scrollLeft+t.left+"px",e[2].style.top=document.scrollingElement.scrollTop+t.top+"px"})},M.push(e))}))},m.findSentenceOf=function(t){var n=new RegExp("\\b"+t+"\\b"),o=getVisibleElements(function(e,t){n.test(e.innerText)&&t.push(e)});o=filterAncestors(o);var r="";return actionWithSelectionPreserved(function(n){n.setPosition(o[0],0),window.find(t,!1,!1,!0,!0)&&(e("s"),r=n.toString())}),r};var R={};return m.style=function(e,t){R[e]=t,S.setAttribute("style",R.cursor||""),C.setAttribute("style",R.marks||"")},m}function createHints(){function e(e){return e===e.toUpperCase()&&e!==e.toLowerCase()}function t(e){var t=0;do{var n=parseInt(getComputedStyle(e).getPropertyValue("z-index"));t+=isNaN(n)||n<0?0:n,e=e.parentNode}while(e&&e!==document.body&&e!==document&&e.nodeType!==e.DOCUMENT_FRAGMENT_NODE);return t}function n(e){var t=r();if(1===t.length){Normal.appendKeysForRepeat("Hints",g);var n=t[0].link;C(n),w.multipleHits?(g="",r()):i(),e&&(Mode.suppressKeyUp(e.keyCode),e.stopImmediatePropagation(),e.preventDefault())}else 0===t.length&&i()}function o(){var e=b.querySelectorAll("#sk_hints>div");e=Array.from(e),v.length>0&&(e=e.filter(function(e){e.label="",setSanitizedContent(e,"");var t=e.link,n=t.innerText;return void 0===n&&(n=t[0]?t[0].textContent:""),n.indexOf(v)!==-1}));var t=m.genLabels(e.length);e.forEach(function(e,n){e.label=t[n],setSanitizedContent(e,t[n])})}function r(){var e=[],t=b.querySelectorAll("#sk_hints>div:not(:empty)");return t.forEach(function(t){var n=t.label;0===g.length?(t.style.opacity=1,setSanitizedContent(t,n),e.push(t)):0===n.indexOf(g)?(t.style.opacity=1,setSanitizedContent(t,'<span style="opacity: 0.2;">'+g+"</span>"+n.substr(g.length)),e.push(t)):t.style.opacity=0}),e}function i(){w={active:!0,tabbed:!1,mouseEvents:["mouseover","mousedown","mouseup","click"],multipleHits:!1},setSanitizedContent(b,""),b.remove(),g="",v="",E=!1,m.exit()}function s(){var e=b.querySelectorAll("#sk_hints>div");e[0].style.zIndex==e[0].zIndex?e.forEach(function(t,n){var o=parseInt(t.style.zIndex);t.style.zIndex=e.length-n+2147483e3-o}):e.forEach(function(e,t){e.style.zIndex=e.zIndex})}function a(e){setSanitizedContent(b,""),b.remove(),g=""}function l(e){var t=(new Date).getTime(),n=h(S,k);n>0&&(m.statusLine+=" - "+((new Date).getTime()-t)+"ms / "+n,Mode.showStatus())}function c(e){setSanitizedContent(b,""),b.setAttribute("mode",e),b.style.display=""}function d(e){c("click");var n=m.genLabels(e.length),o=m.coordinate(),r=createElementWithContent("style","#sk_hints div.myHint{"+N+"}");b.prepend(r);var i=e.map(function(e,r){var i,s=getRealRect(e),a=t(e),l=Math.min(s.width,window.innerWidth);i="right"===runtime.conf.hintAlign?window.pageXOffset+s.left-o.left+l:"left"===runtime.conf.hintAlign?window.pageXOffset+s.left-o.left:window.pageXOffset+s.left-o.left+l/2,i<window.pageXOffset?i=window.pageXOffset:i+32>window.pageXOffset+window.innerWidth&&(i=window.pageXOffset+window.innerWidth-32);var c=createElementWithContent("div",n[r],{"class":"myHint"});return e.dataset.hint_scrollable&&c.classList.add("hint-scrollable"),c.style.top=Math.max(s.top+window.pageYOffset-o.top,0)+"px",c.style.left=i+"px",c.style.zIndex=a+9999,c.zIndex=c.style.zIndex,c.label=n[r],c.link=e,c});i.forEach(function(e){b.appendChild(e)});for(var s=b.querySelectorAll("#sk_hints>div"),a=getRealRect(s[0]),l=1;l<s.length;l++){var d=s[l],u=getRealRect(d);u.top===a.top&&Math.abs(u.left-a.left)<a.width&&(d.style.top=d.offsetTop+d.offsetHeight+"px"),a=getRealRect(d)}document.documentElement.prepend(b)}function u(e,t){t=Object.assign({active:!0,tabbed:!1,mouseEvents:["mouseover","mousedown","mouseup","click"],multipleHits:!1,filterInvisible:!0},t||{});for(var n in t)w[n]=t[n];return m.statusLine=t&&t.statusLine||"Hints to click",t.filterInvisible&&(e=filterInvisibleElements(e)),e.length>0&&d(e),e.length}function f(e,t){m.statusLine="Hints to click",t=Object.assign({active:!0,tabbed:!1,mouseEvents:["mouseover","mousedown","mouseup","click"],multipleHits:!1},t||{});for(var n in t)w[n]=t[n];var o;return w.tabbed?(o=Array.from(getElements("a[href]:not([href^=javascript])")),o=filterInvisibleElements(o)):""===e?(o=getVisibleElements(function(e,t){isElementClickable(e)&&t.push(e)}),o=filterOverlapElements(o)):Array.isArray(e)?o=filterInvisibleElements(e):(o=getVisibleElements(function(t,n){!t.matches(e)||t.disabled||t.readOnly||n.push(t)}),o=filterInvisibleElements(o),o=filterOverlapElements(o)),o.length>0&&d(o),o.length}function p(e,n){for(var o in n)w[o]=n[o];m.statusLine=n&&n.statusLine||"Hints to select text";var r=getVisibleElements(function(e,t){for(var n=e.childNodes,o=0,r=n.length;o<r;o++)if(n[o].nodeType==Node.TEXT_NODE&&n[o].data.length>0){t.push(e);break}});r=r.flatMap(function(e){for(var t=e.childNodes,n=[],o=0,r=t.length;o<r;o++)t[o].nodeType==Node.TEXT_NODE&&t[o].data.trim().length>1&&n.push(t[o]);return n});var i;if(e.flags.indexOf("g")===-1)i=r.map(function(e){return[e,0,""]});else{i=[];for(var s=0,a=r.length;s<a;s++)for(var l,d=r[s];null!=(l=e.exec(d.data));)i.push([d,l.index,l[0]])}if(r=i.map(function(e){var n=getTextNodePos(e[0],e[1]),o=[0,0,window.innerHeight,window.innerWidth];if(runtime.conf.caretViewport&&4===runtime.conf.caretViewport.length&&(o=runtime.conf.caretViewport),0===e[0].data.trim().length||n.top<o[0]||n.left<o[1]||n.top>o[2]||n.left>o[3])return null;var r=t(e[0].parentNode),i=document.createElement("div");return 0===e[1]&&(i.className="begin"),i.style.position="fixed",i.style.top=n.top+"px",i.style.left=n.left+"px",i.style.zIndex=r+9999,i.zIndex=i.style.zIndex,i.link=e,i}).filter(function(e){return null!==e}),document.getSelection().anchorNode&&document.getSelection().collapseToStart(),r.length>0){c("text");var u=m.genLabels(r.length);r.forEach(function(e,t){e.label=u[t],setSanitizedContent(e,u[t]),b.append(e)});var f=createElementWithContent("style","#sk_hints[mode='text'] div{"+x+"}");b.prepend(f),document.documentElement.prepend(b)}return r.length}function h(e,t){return"RegExp"===e.constructor.name?p(e,t):Array.isArray(e)?u(e,t):f(e,t)}var m=new Mode("Hints");m.addEventListener("keydown",function(t){var r=b.querySelectorAll("#sk_hints>div");t.sk_stopPropagation=!0;var a=document.querySelector("#sk_hints[mode=input]>div.activeInput");if(null!==a){var l=a.link;return void(Mode.isSpecialKeyOf("<Esc>",t.sk_keyName)?(l.blur(),i()):t.keyCode===KeyboardUtils.keyCodes.tab?(a.classList.remove("activeInput"),k.activeInput=(k.activeInput+(t.shiftKey?-1:1))%r.length,a=r[k.activeInput],a.classList.add("activeInput"),l=a.link,l.focus()):t.keyCode!==KeyboardUtils.keyCodes.shiftKey&&(t.sk_stopPropagation=!1,i(),Insert.enter(l)))}if(Mode.isSpecialKeyOf("<Esc>",t.sk_keyName))i();else if(t.keyCode===KeyboardUtils.keyCodes.space)b.style.display="none";else if(t.keyCode===KeyboardUtils.keyCodes.shiftKey)s();else if(r.length>0)if(t.keyCode===KeyboardUtils.keyCodes.backspace)g.length>0?(g=g.substr(0,g.length-1),n(t)):v.length>0&&(v=v.substr(0,v.length-1),o());else{var c=t.sk_keyName;e(c)&&(E=!0),""!==c&&(m.numericHints?(c>="0"&&c<="9"?g+=c:(v+=c,o()),n(t)):m.characters.toLowerCase().indexOf(c.toLowerCase())!==-1?(g+=c.toUpperCase(),n(t)):m.scrollKeys.indexOf(c)===-1?i():t.sk_stopPropagation=!1)}}),m.addEventListener("keyup",function(e){e.keyCode===KeyboardUtils.keyCodes.space&&(b.style.display="")});var g="",v="",y=null,w={mouseEvents:["mouseover","mousedown","mouseup","click"]},b=createElementWithContent("div","",{id:"sk_hints",style:"display: block; opacity: 1;"}),E=!1;m.characters="asdfgqwertzxcvb",m.scrollKeys="0jkhlG$";var k={},C=m.dispatchMouseClick,S="";m.onEnter=function(){document.addEventListener("surfingkeys:scrollStarted",a),document.addEventListener("surfingkeys:scrollDone",l)},m.onExit=function(){document.removeEventListener("surfingkeys:scrollStarted",a),document.removeEventListener("surfingkeys:scrollDone",l)},m.genLabels=function(e){var t,n,o,r,i,s;for(o=[""],s=0;o.length-s<e||1===o.length;)for(n=o[s++],r=0,i=m.characters.length;r<i;r++)t=m.characters[r],o.push(t+n);return o=o.slice(s,s+e),o.map(function(e){return e.reverse().toUpperCase()})},m.coordinate=function(){var e=createElementWithContent("div","A",{style:"top: 0; left: 0;"});b.prepend(e),document.documentElement.prepend(b);var t=e.getBoundingClientRect();return setSanitizedContent(b,""),{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}},m.createInputLayer=function(){var e="input",n=getVisibleElements(function(t,n){!t.matches(e)||t.disabled||t.readOnly||"text"!==t.type&&"search"!==t.type&&"password"!==t.type||n.push(t)});if(0===n.length&&null!==document.querySelector(e)&&(document.querySelector(e).scrollIntoView(),n=getVisibleElements(function(t,n){!t.matches(e)||t.disabled||t.readOnly||n.push(t)})),n.length>1){m.enter(),c("input"),n.forEach(function(e,n){var o=e.getBoundingClientRect(),r=t(e),i=document.createElement("div");i.style.position="fixed",i.style.top=o.top+"px",i.style.left=o.left+"px",i.style.width=o.width+"px",i.style.height=o.height+"px",i.style.zIndex=r+9999,i.link=e,i.innerText=" ",b.append(i)}),document.documentElement.prepend(b),k.activeInput=0;var o=document.querySelector("#sk_hints[mode=input]>div");o.classList.add("activeInput"),Normal.passFocus(!0),o.link.focus()}else 1===n.length&&(Normal.passFocus(!0),n[0].focus(),Insert.enter(n[0]))},m.getSelector=function(){return S},m.create=function(e,t,o){m.numericHints&&(m.characters="1234567890"),S=e,C=t,k=o||{};var r=(new Date).getTime(),i=h(e,o);i>(runtime.conf.hintExplicit?0:1)?(m.statusLine+=" - "+((new Date).getTime()-r)+"ms / "+i,m.enter()):n()},m.flashPressedLink=function(e){var t=getRealRect(e),n=createElementWithContent("div","",{style:"position: fixed; box-shadow: 0px 0px 4px 2px #63b2ff; background: transparent; z-index: 2140000000"});n.style.left=t.left+"px",n.style.top=t.top+"px",n.style.width=t.width+"px",n.style.height=t.height+"px",document.body.appendChild(n),setTimeout(function(){n.remove()},300)},m.dispatchMouseClick=function(e,t){if(m.flashPressedLink(e),isEditable(e))m.exit(),Normal.passFocus(!0),e.focus(),Insert.enter(e);else{w.multipleHits||m.exit();var n=w.tabbed,o=w.active;w.multipleHits&&e.href&&(n=!0,o=!1),E&&runtime.conf.hintShiftNonActive?(n=!0,o=!1):E&&window.navigator.userAgent.indexOf("Firefox")!==-1&&(n=!0,o=!0),n?RUNTIME("openLink",{tab:{tabbed:n,active:o},url:e.href}):(m.mouseoutLastElement(),dispatchMouseEvent(e,w.mouseEvents,E),
window.Observer&&window.Observer.turnOnDOMObserver(),y=e)}},m.mouseoutLastElement=function(){y&&(dispatchMouseEvent(y,["mouseout"],!1),y=null)};var x="",N="";return m.style=function(e,t){"text"===t?x=e:N=e},m.feedkeys=function(e){setTimeout(function(){g=e.toUpperCase(),n()},1)},m}function createClipboard(){function e(e){actionWithSelectionPreserved(function(t){document.documentElement.appendChild(n),e(t),n.remove()})}var t={},n=document.createElement("textarea");return n.contentEditable=!0,n.enableAutoFocus=!0,n.id="sk_clipboard",t.read=function(t){e(function(){n.value="",setSanitizedContent(n,""),n.focus(),document.execCommand("Paste")});var o=n.value;""===o&&(o=n.innerHTML.replace(/<br>/gi,"\n")),t({data:o})},t.write=function(t){Normal.insertJS(function(){window.oncopy=document.oncopy,document.oncopy=null},function(){e(function(){n.value=t,n.select(),document.execCommand("copy"),n.value=""}),Normal.insertJS(function(){document.oncopy=window.oncopy,delete window.oncopy}),Front.showBanner("Copied: "+t)})},t}function createUiHost(){function e(e){var t=e.data;void 0!==t&&(t.commandToFrontend||t.responseToFrontend?(o.contentWindow.postMessage(t,n),t.commandToFrontend&&e.source&&["showStatus","showEditor","openOmnibar"].indexOf(t.action)!==-1&&(a&&a.window===e.source||(a&&a.window.postMessage({action:"deactivated",direct:!0,reason:t.action+"@"+e.timeStamp,commandToContent:!0},a.origin),a={window:e.source,origin:t.origin},a.window.postMessage({action:"activated",direct:!0,reason:t.action+"@"+e.timeStamp,commandToContent:!0},a.origin))),"visualUpdatedForFirefox"===t.action&&document.activeElement.blur()):t.action&&s.hasOwnProperty(t.action)?s[t.action](t):(t.commandToContent||t.responseToContent)&&a&&!t.direct&&a.window!==top&&a.window.postMessage(t,a.origin))}var t=document.createElement("div");t.style.display="block",t.style.opacity=1;var n=chrome.runtime.getURL("pages/frontend.html"),o=document.createElement("iframe");o.setAttribute("allowtransparency",!0),o.setAttribute("frameborder",0),o.setAttribute("scrolling","no"),o.setAttribute("class","sk_ui"),o.setAttribute("src",n),o.setAttribute("title","Surfingkeys"),o.style.position="fixed",o.style.left=0,o.style.bottom=0,o.style.width="100%",o.style.height=0,o.style.zIndex=2147483647,t.attachShadow({mode:"open"}),t.shadowRoot.appendChild(o),o.addEventListener("load",function(){this.contentWindow.postMessage({action:"initFrontend",ack:!0,origin:getDocumentOrigin()},n),window.addEventListener("message",e,!0)},{once:!0});var r,i="none",s={},a=null;return s.initFrontendAck=function(e){Front.resolve&&(Front.resolve(window.location.href),Front.resolve=null),Front.applyUserSettings()},s.setFrontFrame=function(e){o.style.height=e.frameHeight,e.pointerEvents&&(o.style.pointerEvents=e.pointerEvents),"none"===e.pointerEvents?(t.blur(),o.blur(),i!==e.pointerEvents&&a&&a.window.postMessage({action:"getBackFocus",commandToContent:!0},a.origin),document.body&&(document.body.style.animationFillMode="",document.body.style.overflowY=r)):document.body&&(document.body.style.animationFillMode="none",void 0===r&&(r=document.body.style.overflowY),document.body.style.overflowY="visible"),i=e.pointerEvents},s.frontendUnloaded=function(n){window.removeEventListener("message",e,!0),t.remove()},t.detach=function(){o.src=chrome.runtime.getURL("")},t}function usePdfViewer(){window.location.replace(chrome.extension.getURL("/pages/pdf_viewer.html")+"?r="+document.URL)}function readText(e,t){t=t||{enqueue:!0,voiceName:runtime.conf.defaultVoice};var n=t.verbose,o=/[\s\u00a0]/g,n=t.verbose,r=t.onEnd;delete t.verbose,delete t.onEnd,RUNTIME("read",{content:e,options:t},function(t){if(n)if("start"===t.ttsEvent.type)Front.showPopup(e);else if("word"===t.ttsEvent.type){o.lastIndex=t.ttsEvent.charIndex;var i,s=o.exec(e);i=s?e.substr(0,t.ttsEvent.charIndex)+"<font style='font-weight: bold; text-decoration: underline'>"+e.substr(t.ttsEvent.charIndex,s.index-t.ttsEvent.charIndex+1)+"</font>"+e.substr(s.index):e.substr(0,t.ttsEvent.charIndex)+"<font style='font-weight: bold; text-decoration: underline'>"+e.substr(t.ttsEvent.charIndex)+"</font>",Front.showPopup(i)}else"end"===t.ttsEvent.type&&Front.hidePopup();return r&&"end"===t.ttsEvent.type&&r(),"end"!==t.ttsEvent.type})}var _slicedToArray=function(){function e(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(l){r=!0,i=l}finally{try{!o&&a["return"]&&a["return"]()}finally{if(r)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Trie.prototype={find:function(e){for(var t=this,n=e.length,o=0;o<n&&t;o++)t=t[e[o]];return t},add:function(e,t){for(var n=this,o=e.length,r=0;r<o;r++){var i=e[r];if(n.hasOwnProperty(i))n=n[i];else{var s=new Trie(i);n[i]=s,n=s}}t.word=e,n.meta=t},remove:function(e){for(var t=this,n=e.length,o=[],r=0;r<n&&t;r++)o.push(t),t=t[e[r]];if(t){var r=o.length-1,i=o[r];delete i[t.stem];for(var s=i;s!==this&&1===Object.keys(s).length;)i=o[--r],delete i[s.stem],s=i}return t},getWords:function(e,t){var n=[],e=(e||"")+(t?"":this.stem||"");this.hasOwnProperty("meta")&&n.push(e);for(var o in this)1===o.length&&(n=n.concat(this[o].getWords(e)));return n},getMetas:function(e){var t=[];this.hasOwnProperty("meta")&&e(this.meta)&&t.push(this.meta);for(var n in this)1===n.length&&(t=t.concat(this[n].getMetas(e)));return t},getPrefixWord:function(){if(0===Object.keys(this).length)return"";for(var e="",t=this.stem,n=this;""===e;)for(var o=Object.keys(n),r=0;r<o.length;r++){if("meta"===o[r]){e=n.meta.word;break}if("stem"!==o[r]){t+=o[r],n=n[o[r]];break}}return e.substr(0,e.length-t.length+1)}},String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","gi");e=e.replace(n,arguments[t])}return e},String.prototype.reverse=function(){return this.split("").reverse().join("")},RegExp.prototype.toJSON=function(){return{source:this.source,flags:this.flags}},Array.prototype.flatMap||(Array.prototype.flatMap=function(e){return Array.prototype.concat.apply([],this.map(e))});var _divForHtmlEncoder=document.createElement("div");HTMLElement.prototype.one=function(e,t){function n(){t.call(this),this.removeEventListener(e,n)}this.addEventListener(e,n)},HTMLElement.prototype.show=function(){this.style.display=""},HTMLElement.prototype.hide=function(){this.style.display="none"},HTMLElement.prototype.removeAttributes=function(){for(;this.attributes.length>0;)this.removeAttribute(this.attributes[0].name)},NodeList.prototype.remove=function(){this.forEach(function(e){e.remove()})},NodeList.prototype.show=function(){this.forEach(function(e){e.show()})},NodeList.prototype.hide=function(){this.forEach(function(e){e.hide()})};var runtime=function(){var e={conf:{autoSpeakOnInlineQuery:!1,lastKeys:"",blacklistPattern:void 0,smartCase:!0,caseSensitive:!1,clickablePat:/(https?:\/\/|thunder:\/\/|magnet:)\S+/gi,clickableSelector:"",editableSelector:"div.CodeMirror-scroll,div.ace_content",cursorAtEndOfInput:!0,defaultSearchEngine:"g",defaultVoice:"Daniel",editableBodyCare:!0,enableAutoFocus:!0,experiment:!1,focusFirstCandidate:!1,focusOnSaved:!0,hintAlign:"center",hintExplicit:!1,hintShiftNonActive:!1,historyMUOrder:!0,language:void 0,lastQuery:"",modeAfterYank:"",nextLinkRegex:/(\b(next)\b)|ä¸‹é¡µ|ä¸‹ä¸€é¡µ|åŽé¡µ|>>|Â»/i,digitForRepeat:!0,omnibarMaxResults:10,omnibarPosition:"middle",omnibarSuggestion:!0,omnibarSuggestionTimeout:200,omnibarTabsQuery:{},pageUrlRegex:[],prevLinkRegex:/(\b(prev|previous)\b)|ä¸Šé¡µ|ä¸Šä¸€é¡µ|å‰é¡µ|<<|Â«/i,richHintsForKeystroke:1e3,scrollStepSize:70,showModeStatus:!1,showProxyInStatusBar:!1,smartPageBoundary:!1,smoothScroll:!0,startToShowEmoji:2,stealFocusOnLoad:!0,tabsThreshold:9,textAnchorPat:/(^[\n\r\s]*\S{3,}|\b\S{4,})/g,ignoredFrameHosts:["https://tpc.googlesyndication.com"],scrollFriction:0,aceKeybindings:"vim",caretViewport:null,mouseSelectToQuery:[],useLocalMarkdownAPI:!0}},t={},n=new Promise(function(e,t){window===top?e(window.location.href):RUNTIME("getTopURL",null,function(t){e(t.url)})});return e.on=function(e,n){t[e]=n},e.updateHistory=function(e,t){var n=e+"History";RUNTIME("getSettings",{key:n},function(e){var o=e.settings[n]||[],r={};"Array"===t.constructor.name?(r[n]=t,RUNTIME("updateSettings",{settings:r})):t.trim().length&&"."!==t&&(o=o.filter(function(e){return e.trim().length&&e!==t&&"."!==e}),o.unshift(t),o.length>50&&o.pop(),r[n]=o,RUNTIME("updateSettings",{settings:r}))})},chrome.runtime.onMessage.addListener(function(e,n,o){t[e.subject]&&t[e.subject](e,n,o)}),e.getTopURL=function(e){n.then(function(t){e(t)})},e.postTopMessage=function(e){n.then(function(t){window===top&&(t=window.location.origin),"null"!==t&&"file://"!==new URL(t).origin||(t="*"),top.postMessage(e,t)})},e.getCaseSensitive=function(t){return e.conf.caseSensitive||e.conf.smartCase&&/[A-Z]/.test(t)},e}();
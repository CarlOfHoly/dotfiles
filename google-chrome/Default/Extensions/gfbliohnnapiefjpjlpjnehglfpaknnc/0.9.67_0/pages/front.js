"use strict";var Front=function(){function e(e,t,n){this.enter=function(){n&&n(),top.postMessage({action:"setFrontFrame",pointerEvents:e,frameHeight:t},d)},this.nextState=function(){var e=Array.from(document.body.querySelectorAll("body>div")).filter(function(e){return"none"!==e.style.display}),t=e.map(function(e){var t=e.id,n=["sk_keystroke","sk_banner"];return n.indexOf(t)===-1&&("sk_status"===t?null!==l.statusBar.querySelector("input"):!e.noPointerEvents)});t.push(!1),t=t.reduce(function(e,t){return e||t});var n;n=t?f:e.length>0?h:p,this!==n&&(m=n,m.enter())}}function t(){E.remove("sk_scroller_indicator_top"),E.remove("sk_scroller_indicator_middle"),E.remove("sk_scroller_indicator_bottom")}function n(e,t){H&&"none"!==H.style.display&&(H.style.display="none",H.onHide&&H.onHide()),H=e,H.style.display="",H.onShow&&H.onShow(t)}function o(e,t){l.enter(0,!0),n(e,t),l.flush()}function i(e,t){var n=["Help","Mouse Click","Scroll Page / Element","Tabs","Page Navigation","Sessions","Search selected with","Clipboard","Omnibar","Visual Mode","vim-like marks","Settings","Chrome URLs","Proxy","Misc","Insert Mode"];initL10n(function(o){var i=n.map(function(){return[]});i[0].push("<div><span class=kbd-span><kbd>&lt;Alt-s&gt;</kbd></span><span class=annotation>{0}</span></div>".format(o("Toggle SurfingKeys on current site"))),e=e.concat(getAnnotations(Omnibar.mappings)),e.forEach(function(e){var t=KeyboardUtils.decodeKeystroke(e.word),n="<div><span class=kbd-span><kbd>"+htmlEncode(t)+"</kbd></span><span class=annotation>"+o(e.annotation)+"</span></div>";i[e.feature_group].push(n)}),i=i.map(function(e,t){return e.length?"<div><div class=feature_name><span>{0}</span></div>{1}</div>".format(o(n[t]),e.join("")):""}).join(""),i+="<p style='float:right; width:100%; text-align:right'><a href='https://github.com/brookhong/surfingkeys' target='_blank' style='color:#0095dd'>"+o("More help")+"</a></p>",t(i)})}function s(){C&&(clearTimeout(C),C=void 0)}function a(e){initL10n(function(t){var n=e.accumulated,o=e.candidates;n=Object.keys(o).sort().map(function(n){var i=o[n];return i.annotation?"<div><span class=kbd-span><kbd>"+htmlEncode(KeyboardUtils.decodeKeystroke(e.accumulated))+"<span class=candidates>"+n.substr(e.accumulated.length)+"</span></kbd></span><span class=annotation>"+t(i.annotation)+"</span></div>":""}).join(""),n.length>0&&C&&(setSanitizedContent(x,n),x.classList.add("expandRichHints"),l.flush())})}function r(){"none"!==v.style.display&&Front.contentCommand({action:"updateInlineQuery"})}window.KeyboardUtils=createKeyboardUtils(),window.Mode=createMode(),window.Normal=createNormal(),window.PassThrough=createPassThrough(),window.Visual=createVisual(),window.Hints=createHints(),window.Clipboard=createClipboard();var d,l=new Mode("Front"),c={},u={};l.contentCommand=function(e,t){e.commandToContent=!0,e.id=generateQuickGuid(),t&&(e.ack=!0,u[e.id]=t),top.postMessage(e,d)},l.addEventListener("keydown",function(e){Mode.isSpecialKeyOf("<Esc>",e.sk_keyName)?(l.hidePopup(),e.sk_stopPropagation=!0):k.trie&&(k.trie=k.trie.find(e.sk_keyName),k.trie?k.trie.meta&&(RUNTIME("focusTab",{tab_id:k.trie.meta.id,window_id:k.trie.meta.windowId}),l.hidePopup(),k.trie=null):(l.hidePopup(),k.trie=null),e.sk_stopPropagation=!0)});var p=new e("none","0px"),h=new e("none","100%"),f=new e("all","100%",function(){window.focus()}),m=p;l.flush=function(){m.nextState()},l.visualCommand=function(e){"none"!==y.style.display?Visual[e.action](e.query):l.contentCommand(e)},l.omnibar=document.getElementById("sk_omnibar"),l.statusBar=document.getElementById("sk_status");var y=document.getElementById("sk_usage"),g=document.getElementById("sk_popup"),w=document.getElementById("sk_editor"),k=document.getElementById("sk_tabs"),b=document.getElementById("sk_banner"),v=document.getElementById("sk_bubble"),_=v.querySelector("div.sk_bubble_content"),S=v.querySelector("div.sk_arrow"),E=_.classList;_.onscroll=function(e){t(),0===this.scrollTop?E.add("sk_scroller_indicator_top"):this.scrollTop+this.offsetHeight>=this.scrollHeight?E.add("sk_scroller_indicator_bottom"):E.add("sk_scroller_indicator_middle")};var H,x=document.getElementById("sk_keystroke");c.hidePopup=function(){H&&"none"!==H.style.display&&(H.style.display="none",l.flush(),H.onHide&&H.onHide(),l.exit())},l.hidePopup=c.hidePopup,k.onShow=function(e){setSanitizedContent(k,""),k.trie=new Trie;var t=Hints.genLabels(e.length);e.forEach(function(e,n){var o=document.createElement("div");o.setAttribute("class","sk_tab"),o.style.width="200px",k.trie.add(t[n].toLowerCase(),e),setSanitizedContent(o,"<div class=sk_tab_hint>"+t[n]+"</div><div class=sk_tab_wrap><div class=sk_tab_icon><img src='chrome://favicon/"+e.url+"'></div><div class=sk_tab_title>"+htmlEncode(e.title)+"</div></div>"),o.url=e.url,k.append(o)}),k.querySelectorAll("div.sk_tab").forEach(function(e){e.append(createElementWithContent("div",e.url,{"class":"sk_tab_url"}))})},c.chooseTab=function(){RUNTIME("getTabs",null,function(e){e.tabs.length>runtime.conf.tabsThreshold?o(l.omnibar,{type:"Tabs"}):e.tabs.length>0&&o(k,e.tabs)})},y.onShow=function(e){i(e.metas,function(e){setSanitizedContent(y,e)})},c.showUsage=function(e){o(y,e)},c.applyUserSettings=function(e){for(var t in e.userSettings)runtime.conf.hasOwnProperty(t)&&(runtime.conf[t]=e.userSettings[t]);"theme"in e.userSettings&&setSanitizedContent(document.getElementById("sk_theme"),e.userSettings.theme)},c.executeCommand=function(e){Commands.execute(e.cmdline)},c.addMapkey=function(e){e.old_keystroke in Mode.specialKeys?Mode.specialKeys[e.old_keystroke].push(e.new_keystroke):window.hasOwnProperty(e.mode)&&_map(window[e.mode],e.new_keystroke,e.old_keystroke)},c.addVimMap=function(e){l.vimMappings.push([e.lhs,e.rhs,e.ctx])},c.addVimKeyMap=function(e){l.vimKeyMap=e.vimKeyMap},c.addSearchAlias=function(e){SearchEngine.aliases[e.alias]={prompt:""+e.prompt+separatorHtml,url:e.url,suggestionURL:e.suggestionURL}},c.removeSearchAlias=function(e){delete SearchEngine.aliases[e.alias]},c.getUsage=function(e){delete e.ack,i(e.metas,function(t){top.postMessage({data:t,action:e.action+"Ack",responseToContent:e.commandToFrontend,id:e.id},d)})},l.showUsage=l.hidePopup,c.showPopup=function(e){l.showPopup(e.content)},l.showPopup=function(e){setSanitizedContent(g,e),o(g)},l.vimMappings=[],w.onShow=function(e){"undefined"!=typeof AceEditor?AceEditor.show(e):Normal.insertJS("../libs/ace/ace.js",function(){ace.config.set("workerPath","../libs/ace"),ace.config.set("modePath","../libs/ace"),ace.config.set("themePath","../libs/ace"),ace.config.set("basePath","../libs/ace"),Normal.insertJS("editor.js",function(){AceEditor.show(e)})})},c.showEditor=function(e){e.onEditorSaved&&(l.onEditorSaved=e.onEditorSaved),o(w,e)},l.showEditor=c.showEditor,c.updateOmnibarResult=function(e){Omnibar.listWords(e.words)},c.openOmnibar=function(e){o(l.omnibar,e);var t=e.style||"";setSanitizedContent(l.omnibar.querySelector("style"),"#sk_omnibar {"+t+"}")},l.openOmnibar=c.openOmnibar,c.openFinder=function(){Find.open()},l.openFinder=c.openFinder,l.showBanner=function(e,t){b.style.cssText="",b.style.display="",b.style.top="0px",setSanitizedContent(b,htmlEncode(e)),l.flush();var n=t||1600;setTimeout(function(){b.style.cssText="",b.style.display="none",l.flush()},n)},c.showBanner=function(e){l.showBanner(e.content,e.linger_time)},c.showBubble=function(e){var o=e.position;o.left+=o.winX,o.top+=o.winY,v.style.top="0px",v.style.left="0px",setSanitizedContent(_,e.content),_.style.maxWidth=o.winWidth-32+"px",_.scrollTop=0,t(),v.style.display="";var i=v.offsetWidth,s=v.offsetHeight,a=[o.left-11-i/2,i/2];a[0]<o.winX?(a[1]+=a[0]-o.winX,a[0]=o.winX):a[0]+i>o.winWidth&&(a[1]+=a[0]-o.winX-o.winWidth+i,a[0]=o.winX+o.winWidth-i),S.style.left=a[1]+o.width/2-2+"px",v.style.left=a[0]+"px",v.noPointerEvents=e.noPointerEvents,o.top+o.height/2>o.winHeight/2?(S.setAttribute("dir","down"),S.style.top="100%",_.style.maxHeight=o.top-12-32+"px",s=v.offsetHeight,v.style.top=o.top-s-12+"px"):(S.setAttribute("dir","up"),S.style.top="-12px",_.style.maxHeight=o.winHeight-(o.top+o.height+12)-32+"px",s=v.offsetHeight,v.style.top=o.top+o.height+12+"px"),_.scrollHeight>_.offsetHeight&&(v.noPointerEvents=!1,E.add("sk_scroller_indicator_top")),l.flush(),v.noPointerEvents||(n(v,{}),l.enter(0,!0))},l.showBubble=function(){},c.hideBubble=function(){v.style.display="none",l.flush()},l.hideBubble=c.hideBubble,c.visualUpdatedForFirefox=function(e){l.statusBar.querySelector("input").focus()},c.showStatus=function(e){Mode.stack()[0]!==Find&&l.showStatus(e.position,e.content,e.duration)},l.showStatus=function(e,t,n){StatusBar.show(e,t,n)},l.toggleStatus=function(e){e?l.statusBar.style.display="":l.statusBar.style.display="none"},c.toggleStatus=function(e){l.toggleStatus(e.visible)};var C;return c.hideKeystroke=function(){"none"!==x.style.display&&(x.classList.remove("expandRichHints"),setSanitizedContent(x,""),x.style.display="none",l.flush()),runtime.conf.richHintsForKeystroke>0&&runtime.conf.richHintsForKeystroke<1e4&&s()},l.hideKeystroke=c.hideKeystroke,Visual.mappings.add("y",{annotation:"Yank a word(w) or line(l) or sentence(s) or paragraph(p)",feature_group:9}),c.showKeystroke=function(e){if("none"!==x.style.display&&x.classList.contains("expandRichHints"))a(e.keyHints);else{s(),x.style.display="",l.flush();var t=x.innerHTML+htmlEncode(KeyboardUtils.decodeKeystroke(e.keyHints.key));setSanitizedContent(x,t),runtime.conf.richHintsForKeystroke>0&&runtime.conf.richHintsForKeystroke<1e4&&(C=setTimeout(function(){a(e.keyHints)},runtime.conf.richHintsForKeystroke))}},l.showKeystroke=function(){},c.initFrontend=function(e){return d=e.origin,(new Date).getTime()},window.addEventListener("message",function(e){var t=e.data;if(u[t.id]){var n=u[t.id];n(t)||delete u[t.id]}else if(t.action&&c.hasOwnProperty(t.action)){var o=c[t.action](t);t.ack&&top.postMessage({data:o,action:t.action+"Ack",responseToContent:t.commandToFrontend,id:t.id},d)}},!0),document.onmouseup=function(e){if(v.contains(e.target)){var t=window.getSelection().toString().trim()||Visual.getWordUnderCursor();t&&t.length>0&&Front.contentCommand({action:"updateInlineQuery",word:t},function(){window.addEventListener("resize",r)})}else v.style.display="none",Front.flush(),Front.visualCommand({action:"emptySelection"}),window.removeEventListener("resize",r)},v.querySelector("div.sk_bubble_content").addEventListener("mousewheel",function(e){(e.deltaY>0&&this.scrollTop+this.offsetHeight>=this.scrollHeight||e.deltaY<0&&this.scrollTop<=0)&&e.preventDefault()},{passive:!1}),window.addEventListener("beforeunload",function(){top.postMessage({action:"frontendUnloaded"},d)}),l}();
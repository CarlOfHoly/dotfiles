"use strict";function _regexFromString(str,highlight){var rxp=null;if(/^\/.+\/([gimuy]*)$/.test(str))try{rxp=eval(str)}catch(e){rxp=null}if(!rxp&&(/^\/.+$/.test(str)&&(rxp=eval(str+"/i")),!rxp))if(str=str.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),highlight)rxp=new RegExp(str.replace(/\s+/,"|"),"gi");else{var words=str.split(/\s+/).map(function(e){return"(?=.*"+e+")"}).join("");rxp=new RegExp("^"+words+".*$","gi")}return rxp}function _filterByTitleOrUrl(e,t){if(t&&t.length){var n=_regexFromString(t,!1);e=e.filter(function(e){return n.test(e.title)||n.test(e.url)})}return e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},separator="‚û§",separatorHtml="<span class='separator'>"+separator+"</span>",Omnibar=function(){function e(e){var t=Array.from(i.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li")),n=t.length;if(n>0){var r=i.resultsDiv.querySelector("li.focused");r&&r.classList.remove("focused");var o=t.indexOf(r);o=o===-1?n:o;var a=(e?o+n:o+n+2)%(n+1);a<n?(Omnibar.focusItem(t[a]),s.onTabKey&&s.onTabKey()):i.input.value=l}}function t(){l!==i.input.value&&(l=i.input.value),s.onInput&&s.onInput.call(this)}function n(e){s&&s.onKeydown&&s.onKeydown.call(e.target,e)&&e.preventDefault(),Mode.isSpecialKeyOf("<Esc>",e.sk_keyName)?(Front.hidePopup(),e.preventDefault()):e.keyCode===KeyboardUtils.keyCodes.enter?(s.activeTab=!e.ctrlKey,s.tabbed=Omnibar.tabbed^e.shiftKey,s.onEnter()&&Front.hidePopup()):e.keyCode===KeyboardUtils.keyCodes.space?i.expandAlias(i.input.value,"")&&e.preventDefault():e.keyCode===KeyboardUtils.keyCodes.backspace&&i.collapseAlias()&&e.preventDefault()}function r(){var e=document.createElement("input");return e.oninput=t,e.onkeydown=n,e.addEventListener("compositionstart",function(t){e.oninput=null,e.onkeydown=null}),e.addEventListener("compositionend",function(r){e.oninput=t,e.onkeydown=n,t()}),e}function o(){var e=(p-1)*v,t=e+v;t=t>f.length?f.length:t,setSanitizedContent(m,e+1+" - "+t+" / "+f.length),g=f.slice(e,t);var n=i.input.value.trim(),r=null;n.length&&(r=_regexFromString(n,!0)),i.listResults(g,function(e){var t;if(e.hasOwnProperty("html"))t=i.createItemFromRawHtml(e);else if(e.hasOwnProperty("url")&&void 0!==e.url){if(window.navigator.userAgent.indexOf("Firefox")!==-1&&/^(place|data):/i.test(e.url))return null;t=i.createURLItem(e,r)}else b&&(t=createElementWithContent("li",'<div class="title">‚ñ∑ '+i.highlight(r,e.title)+"</div>"),t.folder_name=e.title,t.folderId=e.id);return t})}var i=new Mode("Omnibar");i.addEventListener("keydown",function(e){e.sk_keyName.length&&Mode.handleMapKey.call(i,e),e.sk_suppressed=!0}).addEventListener("mousedown",function(e){e.sk_suppressed=!0}),i.mappings=new Trie,i.map_node=i.mappings,i.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-d>"),{annotation:"Delete focused item from bookmark or history",feature_group:8,code:function(){var e=Omnibar.resultsDiv.querySelector("li.focused");e&&e.uid&&RUNTIME("removeURL",{uid:e.uid},function(t){"Done"===t.response&&e.remove()})}}),i.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-i>"),{annotation:"Edit selected URL with vim editor, then open",feature_group:8,code:function(){var e=Omnibar.resultsDiv.querySelector("li.focused");e&&e.url&&Front.showEditor({initial_line:1,type:"url",content:e.url,onEditorSaved:function(e){e&&tabOpenLink(e)}})}}),i.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-j>"),{annotation:"Toggle Omnibar's position",feature_group:8,code:function(){"bottom"===runtime.conf.omnibarPosition?runtime.conf.omnibarPosition="middle":runtime.conf.omnibarPosition="bottom",setTimeout(function(){y.pref=i.input.value,Front.hidePopup(),Front.openOmnibar(y)},1)}}),i.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-.>"),{annotation:"Show results of next page",feature_group:8,code:function(){f&&(p*v<f.length?p++:p=1,o())}}),i.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-,>"),{annotation:"Show results of previous page",feature_group:8,code:function(){f&&(p>1?p--:p=Math.ceil(f.length/v),o())}}),i.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-c>"),{annotation:"Copy all listed items",feature_group:8,code:function(){i.input.style.display="none",Clipboard.write(JSON.stringify(g,null,4)),i.input.style.display=""}}),i.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-D>"),{annotation:"Delete all listed items from bookmark or history",feature_group:8,code:function(){var e=Array.from(Omnibar.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li")).map(function(e){return e.uid}).filter(function(e){return e});e.length&&RUNTIME("removeURL",{uid:e},function(e){"Done"===e.response&&(s&&s.getResults&&s.getResults(),Omnibar.triggerInput())})}}),i.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-r>"),{annotation:"Re-sort history by visitCount or lastVisitTime",feature_group:8,code:function(){s&&s.onReset&&s.onReset()}}),i.mappings.add(KeyboardUtils.encodeKeystroke("<Esc>"),{annotation:"Close Omnibar",feature_group:8,code:function(){Front.hidePopup()}}),i.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-m>"),{annotation:"Create vim-like mark for selected item",feature_group:8,code:function(e){var t=Omnibar.resultsDiv.querySelector("li.focused");t&&Normal.addVIMark(e,t.url)}});var a,s,u={},l="",c=null,d=Front.omnibar;d.onclick=function(e){s.onClick?s.onClick(e):i.input.focus()},i.triggerInput=function(){var e=new Event("input",{bubbles:!0,cancelable:!0});i.input.dispatchEvent(e)},i.expandAlias=function(e,t){var n=!1;return s!==SearchEngine&&e.length&&SearchEngine.aliases.hasOwnProperty(e)&&(c=s,s=SearchEngine,Object.assign(SearchEngine,SearchEngine.aliases[e]),setSanitizedContent(i.resultsDiv,""),setSanitizedContent(i.promptSpan,s.prompt),setSanitizedContent(m,""),f=null,i.collapsingPoint=t,i.input.value=t,t.length&&Omnibar.triggerInput(),n=!0),n},i.collapseAlias=function(){var e=!1,t=i.input.value;return!c||s===c||t!==i.collapsingPoint&&""!==t||(s=c,c=null,setSanitizedContent(i.promptSpan,s.prompt),t.length&&(i.input.value=t.substr(0,t.length-1)),Omnibar.triggerInput(),e=!0),e},i.focusItem=function(e){"string"==typeof e&&(e=i.resultsDiv.querySelector(e)),e.classList.add("focused"),scrollIntoViewIfNeeded(e)},i.promptSpan=d.querySelector("#sk_omnibarSearchArea>span.prompt");var m=d.querySelector("#sk_omnibarSearchArea>span.resultPage");i.resultsDiv=d.querySelector("#sk_omnibarSearchResult"),i.mappings.add(KeyboardUtils.encodeKeystroke("<Tab>"),{annotation:"Forward cycle through the candidates.",feature_group:8,code:function(){e("bottom"===runtime.conf.omnibarPosition)}}),i.mappings.add(KeyboardUtils.encodeKeystroke("<Shift-Tab>"),{annotation:"Backward cycle through the candidates.",feature_group:8,code:function(){e("bottom"!==runtime.conf.omnibarPosition)}}),i.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-'>"),{annotation:"Toggle quotes in an input element",feature_group:8,code:toggleQuote}),i.highlight=function(e,t){return"data:image/"===t.substr(0,11)&&(t=t.substr(0,1024)),null===e?t:t.replace(e,function(e){return"<span class=omnibar_highlight>"+e+"</span>"})},i.createURLItem=function(e,t){e.title=e.title&&""!==e.title?e.title:e.url;var n=e.type,r="",o=e.uid;n||(e.hasOwnProperty("lastVisitTime")?(n="üïú",r="<span class=omnibar_timestamp># "+timeStampString(e.lastVisitTime)+"</span>",r+="<span class=omnibar_visitcount> ("+e.visitCount+")</span>",o="H"+e.url):e.hasOwnProperty("dateAdded")?(n="‚≠ê",r="<span class=omnibar_folder>@ "+(a[e.parentId].title||"")+"</span> <span class=omnibar_timestamp># "+timeStampString(e.dateAdded)+"</span>",o="B"+e.id):e.hasOwnProperty("width")?(n="üîñ",o="T"+e.windowId+":"+e.id):n="üî•");var s=createElementWithContent("li",'<div class="title">'+n+" "+i.highlight(t,htmlEncode(e.title))+" "+r+'</div><div class="url">'+i.highlight(t,e.url)+"</div>");return s.uid=o,s.url=e.url,s},i.createItemFromRawHtml=function(e){var t=e.html,n=e.props,r=createElementWithContent("li",t);return"object"===("undefined"==typeof n?"undefined":_typeof(n))&&Object.assign(r,n),r},i.detectAndInsertURLItem=function(e,t){var n=/^(?:https?:\/\/)?(?:[^@\/\n]+@)?(?:www\.)?([^:\/\n\s]+)\.([^:\/\n\s]+)/i,r=/^https?:\/\/(?:[^@\/\n]+@)?([^:\/\n\s]+)/i;if(n.test(e)){var o=e;/^https?:\/\//.test(e)||(o="http://"+e),t.unshift({title:e,url:o})}else r.test(e)&&t.unshift({title:e,url:e})};var p,f,b,v,g;i.listURLs=function(e,t){v=runtime.conf.omnibarMaxResults||10,p=1,f=e,b=t,o()};var y;return d.onShow=function(e){i.input||(i.input=r(),document.querySelector("#sk_omnibarSearchArea").insertBefore(i.input,m)),y=e,d.classList.remove("sk_omnibar_middle"),d.classList.remove("sk_omnibar_bottom"),d.classList.add("sk_omnibar_"+runtime.conf.omnibarPosition),"bottom"===runtime.conf.omnibarPosition?(i.resultsDiv.remove(),d.insertBefore(i.resultsDiv,document.querySelector("#sk_omnibarSearchArea"))):(i.resultsDiv.remove(),d.append(i.resultsDiv)),i.tabbed=void 0===e.tabbed||e.tabbed,s=u[e.type],i.input.focus(),i.enter(),e.pref&&(i.input.value=e.pref),s.onOpen&&s.onOpen(e.extra),c=s,s=s,setSanitizedContent(i.promptSpan,s.prompt),setSanitizedContent(m,""),d.scrollTop=0},d.onHide=function(){delete i.cachedPromise,f=null,a=null,l="",i.input.value="",setSanitizedContent(i.resultsDiv,""),c=null,s.onClose&&s.onClose(),i.exit(),s=null},i.openFocused=function(){var e,t=i.resultsDiv.querySelector("li.focused");t?e=t.url:(e=i.input.value,e.indexOf(":")===-1&&(e=SearchEngine.aliases[runtime.conf.defaultSearchEngine].url+e));var n,r="";return t&&t.uid&&(n=t.uid,r=n[0],n=n.substr(1)),"T"===r?(n=n.split(":"),RUNTIME("focusTab",{window_id:parseInt(n[0]),tab_id:parseInt(n[1])})):e&&e.length&&RUNTIME("openLink",{tab:{tabbed:this.tabbed,active:this.activeTab},url:e}),this.activeTab},i.listResults=function(e,t){if(setSanitizedContent(i.resultsDiv,""),e&&0!==e.length){"bottom"===runtime.conf.omnibarPosition&&e.reverse();var n=document.createElement("ul");if(e.forEach(function(e){var r=t(e);r&&n.append(r)}),i.resultsDiv.append(n),e=i.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li"),runtime.conf.focusFirstCandidate||s.focusFirstCandidate){var r="bottom"===runtime.conf.omnibarPosition?e.length-1:0;e[r].classList.add("focused")}"bottom"===runtime.conf.omnibarPosition&&e.length>0&&scrollIntoViewIfNeeded(e[e.length-1])}},i.listWords=function(e){i.listResults(e,function(e){var t=createElementWithContent("li","‚åï "+e);return t.query=e,t})},i.html=function(e){setSanitizedContent(i.resultsDiv,e)},i.addHandler=function(e,t){u[e]=t},i.listBookmarkFolders=function(e){RUNTIME("getBookmarkFolders",null,function(t){a={},t.folders.forEach(function(e){a[e.id]=e}),e&&e(t,a)})},i}(),OpenBookmarks=function(){function e(){var e=n.inFolder.pop();e.folderId?(t=e.folderId,RUNTIME("getBookmarks",{parentId:t},n.onResponse)):(t=void 0,RUNTIME("getBookmarks",null,n.onResponse)),n.prompt=e.prompt,setSanitizedContent(Omnibar.promptSpan,n.prompt),o=e.focused}var t,n={prompt:"bookmark"+separatorHtml,inFolder:[]},r=!1,o=0;return n.onEnter=function(){var e=Array.from(Omnibar.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li")),r=!1,i=Omnibar.resultsDiv.querySelector("li.focused"),a=i.folderId;return a?(n.inFolder.push({prompt:n.prompt,folderId:t,focused:e.indexOf(i)}),n.prompt=i.folder_name+separator,setSanitizedContent(Omnibar.promptSpan,n.prompt),Omnibar.input.value="",t=a,o=0,RUNTIME("getBookmarks",{parentId:t},OpenBookmarks.onResponse)):(r=Omnibar.openFocused.call(n),r&&(n.inFolder.push({prompt:n.prompt,folderId:t,focused:e.indexOf(i)}),localStorage.setItem("surfingkeys.lastOpenBookmark",JSON.stringify(n.inFolder)))),r},n.onOpen=function(){Omnibar.listBookmarkFolders(function(){var t=localStorage.getItem("surfingkeys.lastOpenBookmark");t?(n.inFolder=JSON.parse(t),e()):RUNTIME("getBookmarks",null,n.onResponse),""!==Omnibar.input.value&&n.onInput()})},n.onClose=function(){n.inFolder=[],n.prompt="bookmark"+separatorHtml,t=void 0},n.onKeydown=function(o){var i=!1;if(o.keyCode===KeyboardUtils.keyCodes.comma)r=!r,n.prompt=r?"bookmark folder"+separator:"bookmark"+separator,setSanitizedContent(Omnibar.promptSpan,n.prompt),RUNTIME("getBookmarks",{parentId:t,query:Omnibar.input.value},n.onResponse),i=!0;else if(o.keyCode===KeyboardUtils.keyCodes.backspace&&n.inFolder.length&&!Omnibar.input.value.length)e(),i=!0;else if(o.ctrlKey&&o.shiftKey&&KeyboardUtils.isWordChar(o)){var a=Omnibar.resultsDiv.querySelector("li.focused");if(a){var s=String.fromCharCode(o.keyCode);Normal.addVIMark(s,a.url),i=!0}}return i},n.onInput=function(){RUNTIME("getBookmarks",{parentId:t,query:Omnibar.input.value},n.onResponse)},n.onResponse=function(e){var t=e.bookmarks;r&&(t=t.filter(function(e){return!e.hasOwnProperty("url")||void 0===e.url})),Omnibar.listURLs(t,!0);var t=Omnibar.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li");Omnibar.focusItem(t[o])},n}();Omnibar.addHandler("Bookmarks",OpenBookmarks);var AddBookmark=function(){var e,t={focusFirstCandidate:!0,prompt:"add bookmark"+separatorHtml};return t.onOpen=function(n){t.page=n,Omnibar.listBookmarkFolders(function(n){e=n.folders,Omnibar.listResults(e.slice(),function(e){return createElementWithContent("li","‚ñ∑ "+e.title,{folder:e.id})}),RUNTIME("getBookmark",null,function(e){if(e.bookmarks.length){var n=e.bookmarks[0];setSanitizedContent(Omnibar.promptSpan,"edit bookmark"+separatorHtml),Omnibar.resultsDiv.querySelector("li.focused").classList.remove("focused"),Omnibar.focusItem('li[folder="'+n.parentId+'"]')}var r=localStorage.getItem("surfingkeys.lastAddedBookmark");r&&(Omnibar.input.value=r,Omnibar.input.select(),t.onInput())})})},t.onTabKey=function(){var e=Omnibar.resultsDiv.querySelector("li.focused");Omnibar.input.value=e.innerHTML.substr(2)},t.onEnter=function(){t.page.path=[];var n,r=Omnibar.resultsDiv.querySelector("li.focused");if(r)t.page.folder=r.getAttribute("folder"),n=r.innerHTML.substr(2);else{var o=Omnibar.input.value;o=o.split("/");var i=o.pop();i.length&&(t.page.title=i),o=o.filter(function(e){return e.length>0});for(var a=o.length;a>0;a--){var s=e.filter(function(e){return e.title==="/"+o.slice(0,a).join("/")+"/"});if(s.length){t.page.folder=s[0].id,t.page.path=o.slice(a),n="/"+o.join("/");break}}void 0===t.page.folder&&(t.page.folder=e[0].id,t.page.path=o,n=""+e[0].title+o.join("/"))}return RUNTIME("createBookmark",{page:t.page},function(e){Front.showBanner("Bookmark created at {0}.".format(n),3e3)}),localStorage.setItem("surfingkeys.lastAddedBookmark",Omnibar.input.value),!0},t.onInput=function(){var t=Omnibar.input.value,n=runtime.getCaseSensitive(t),r=e.filter(function(e){return n?e.title.indexOf(t)!==-1:e.title.toLowerCase().indexOf(t.toLowerCase())!==-1});Omnibar.listResults(r,function(e){return createElementWithContent("li","‚ñ∑ "+e.title,{folder:e.id})})},t}();Omnibar.addHandler("AddBookmark",AddBookmark);var OpenHistory=function(){var e={prompt:"history"+separatorHtml};return e.onOpen=function(t){e.getResults(),e.onInput()},e.getResults=function(){Omnibar.cachedPromise=new Promise(function(e,t){RUNTIME("getHistory",{sortByMostUsed:runtime.conf.historyMUOrder},function(t){e(t.history)})})},e.onReset=function(){runtime.conf.historyMUOrder=!runtime.conf.historyMUOrder,Omnibar.cachedPromise.then(function(e){e=runtime.conf.historyMUOrder?e.sort(function(e,t){return t.visitCount-e.visitCount}):e.sort(function(e,t){return t.lastVisitTime-e.lastVisitTime});var t=_filterByTitleOrUrl(e,Omnibar.input.value);Omnibar.listURLs(t,!1)})},e.onEnter=Omnibar.openFocused.bind(e),e.onInput=function(){Omnibar.cachedPromise.then(function(e){var t=_filterByTitleOrUrl(e,Omnibar.input.value);Omnibar.listURLs(t,!1)})},e}();Omnibar.addHandler("History",OpenHistory);var OpenURLs=function(){var e={prompt:""+separatorHtml};return e.getResults=function(){"getAllSites"===e.action?Omnibar.cachedPromise=new Promise(function(e,t){RUNTIME("getTabs",{queryInfo:runtime.conf.omnibarTabsQuery},function(t){var n=t.tabs;RUNTIME("getTopSites",null,function(t){n=n.concat(t.urls),Omnibar.listBookmarkFolders(function(){RUNTIME("getAllURLs",null,function(t){n=n.concat(t.urls),e(n)})})})})}):Omnibar.cachedPromise=new Promise(function(t,n){RUNTIME(e.action,null,function(e){t(e.urls)})})},e.onOpen=function(t){e.action=t,"getRecentlyClosed"===e.action?e.prompt="Recently closed"+separatorHtml:"getTabURLs"===e.action?e.prompt="Tab History"+separatorHtml:e.prompt=""+separatorHtml,e.getResults(),e.onInput()},e.onEnter=Omnibar.openFocused.bind(e),e.onInput=function(){Omnibar.cachedPromise.then(function(e){var t=Omnibar.input.value,n=_filterByTitleOrUrl(e,t);0===n.length?Omnibar.expandAlias(runtime.conf.defaultSearchEngine,t):(Omnibar.detectAndInsertURLItem(t,n),Omnibar.listURLs(n,!1))})},e}();Omnibar.addHandler("URLs",OpenURLs);var OpenTabs=function(){var e={focusFirstCandidate:!0,prompt:"tabs"+separatorHtml};return e.getResults=function(){Omnibar.cachedPromise=new Promise(function(e,t){RUNTIME("getTabs",{query:""},function(t){e(t.tabs)})})},e.onEnter=Omnibar.openFocused.bind(e),e.onOpen=function(){e.getResults(),e.onInput()},e.onInput=function(){Omnibar.cachedPromise.then(function(e){var t=_filterByTitleOrUrl(e,Omnibar.input.value);Omnibar.listURLs(t,!1)})},e}();Omnibar.addHandler("Tabs",OpenTabs);var OpenVIMarks=function(){var e={focusFirstCandidate:!0,prompt:"VIMarks"+separatorHtml};return e.onOpen=function(){var e=Omnibar.input.value,t=[];RUNTIME("getSettings",{key:"marks"},function(n){for(var r in n.settings.marks){var o=n.settings.marks[r];"string"==typeof o&&(o={url:o,scrollLeft:0,scrollTop:0}),""!==e&&o.url.indexOf(e)===-1||t.push({title:r,type:"‚ô°",uid:"M"+r,url:o.url})}Omnibar.listURLs(t,!1)})},e.onEnter=Omnibar.openFocused.bind(e),e.onInput=e.onOpen,e}();Omnibar.addHandler("VIMarks",OpenVIMarks);var SearchEngine=function(){function e(){o&&(clearTimeout(o),o=void 0)}function t(e,t){return e.indexOf("%s")!==-1?e.replace("%s",t):e+t}function n(e){Omnibar.detectAndInsertURLItem(Omnibar.input.value,e);var t=_regexFromString(encodeURIComponent(Omnibar.input.value),!0);Omnibar.listResults(e,function(e){if(e.hasOwnProperty("html"))return Omnibar.createItemFromRawHtml(e);if(e.hasOwnProperty("url"))return Omnibar.createURLItem(e,t);var n=createElementWithContent("li","‚åï "+e);return n.query=e,n})}var r={};r.aliases={};var o=void 0;return r.onOpen=function(e){Object.assign(r,r.aliases[e]);var t=Omnibar.input.value;if(t.length){var n=t.match(/^(site:\S+\s*).*/);n&&Omnibar.input.setSelectionRange(n[1].length,t.length),Omnibar.triggerInput()}},r.onClose=function(){e(),r.prompt=void 0,r.url=void 0,r.suggestionURL=void 0},r.onTabKey=function(){var e=Omnibar.resultsDiv.querySelector("li.focused");e&&e.query&&(Omnibar.input.value=e.query)},r.onEnter=function(){var e,t=Omnibar.resultsDiv.querySelector("li.focused");return e=t?t.url||constructSearchURL(r.url,t.query||encodeURIComponent(Omnibar.input.value)):constructSearchURL(r.url,encodeURIComponent(Omnibar.input.value)),RUNTIME("openLink",{tab:{tabbed:this.tabbed,active:this.activeTab},url:e}),this.activeTab},r.onInput=function(){var i=r.suggestionURL,a=i&&runtime.conf.omnibarSuggestion;return a?(e(),void(o=setTimeout(function(){RUNTIME("request",{method:"get",url:t(r.suggestionURL,encodeURIComponent(Omnibar.input.value))},function(e){Front.contentCommand({action:"getSearchSuggestions",url:r.suggestionURL,response:e},function(e){e=e.data,Array.isArray(e)||(e=[]),n(e)})})},runtime.conf.omnibarSuggestionTimeout))):void n([])},r}();Omnibar.addHandler("SearchEngine",SearchEngine);var Commands=function(){function e(e){for(var e=e.trim(),t=[],n=!1,r="",o=0;o<e.length;o++)" "!==e.charAt(o)||n?'"'===e.charAt(o)?n=!n:r+=e.charAt(o):(t.push(r),r="");return t.push(r),t}var t={focusFirstCandidate:!0,prompt:":",items:{}},n=0;return t.onOpen=function(){n=-1,RUNTIME("getSettings",{key:"cmdHistory"},function(e){var t=e.settings.cmdHistory;t.length&&Omnibar.listResults(t,function(e){var t=createElementWithContent("li",e);return t.cmd=e,t})})},t.onReset=t.onOpen,t.onInput=function(){var e=Omnibar.input.value,n=Object.keys(t.items).filter(function(t){return""===e||t.indexOf(e)!==-1});n.length&&Omnibar.listResults(n,function(e){var n=createElementWithContent("li",e+"<span class=annotation>"+htmlEncode(t.items[e].annotation)+"</span>");return n.cmd=e,n})},t.onTabKey=function(){Omnibar.input.value=Omnibar.resultsDiv.querySelector("li.focused").cmd},t.onEnter=function(){var e=!1,n=Omnibar.input.value;return n.length&&(runtime.updateHistory("cmd",n),t.execute(n),Omnibar.input.value=""),e},t.execute=function(n){var r=e(n),o=r.shift();if(t.items.hasOwnProperty(o)){var i=t.items[o];i.code.call(i.code,r)}else Front.contentCommand({action:"executeScript",cmdline:n})},t}();Omnibar.addHandler("Commands",Commands);var OmniQuery=function(){function e(e,t,n){return n.indexOf(e)===t}var t,n={prompt:"«≠"};return n.onOpen=function(n){n&&(Omnibar.input.value=n,Front.contentCommand({action:"omnibar_query_entered",query:n})),Front.contentCommand({action:"getPageText"},function(n){var r=/[^a-zA-Z]+/;t=n.data.toLowerCase().split(r).filter(e)})},n.onInput=function(){var e=Omnibar.input.value,n=t.filter(function(t){return t.indexOf(e)!==-1});n.length&&Omnibar.listResults(n,function(e){return createElementWithContent("li",e)})},n.onTabKey=function(){Omnibar.input.value=Omnibar.resultsDiv.querySelector("li.focused").innerText},n.onEnter=function(){Front.contentCommand({action:"omnibar_query_entered",query:Omnibar.input.value})},n}();Omnibar.addHandler("OmniQuery",OmniQuery);var OpenUserURLs=function(){var e,t={focusFirstCandidate:!0,prompt:"UserURLs"+separatorHtml};return t.onOpen=function(n){e=n,t.onInput()},t.onInput=function(){var t=Omnibar.input.value,n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;""!==t&&u.title.indexOf(t)===-1&&u.url.indexOf(t)===-1||n.push({title:u.title,type:"‚ô°",url:u.url})}}catch(l){o=!0,i=l}finally{try{!r&&s["return"]&&s["return"]()}finally{if(o)throw i}}Omnibar.listURLs(n,!1)},t.onEnter=Omnibar.openFocused.bind(t),t}();Omnibar.addHandler("UserURLs",OpenUserURLs);